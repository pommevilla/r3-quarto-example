<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.2.89">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Example Quarto Site for R – Sample Analysis</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../site_libs/quarto-nav/headroom.min.js"></script>
  <meta name="quarto:offset" content="../">
  <script src="../site_libs/quarto-search/autocomplete.min.js"></script>
  <script src="../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../site_libs/quarto-search/quarto-search.js"></script>
  <link href="../docs/third.html" rel="prev">
  <script src="../site_libs/quarto-html/quarto.js"></script>
  <script src="../site_libs/quarto-html/popper.min.js"></script>
  <script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../site_libs/quarto-html/clipboard.min.js"></script>
  <script src="../site_libs/quarto-html/anchor.min.js"></script>
  <link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div id="quarto-search-results"></div>
<header id="quarto-header" class="headroom fixed-top">
<nav class="navbar navbar-expand-lg navbar-light bg-primary ">
    <div class="container-fluid">
  <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Example Quarto Site for R3</span>
  </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://r3-rmedicine.netlify.app/">R3 @ R/Medicine</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://quarto.org">Quarto docs</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pommevilla/r3-quarto-example"><i class="bi-github" role="img" aria-label="Source Code">
</i> 
 </a>
  </li>  
  <li class="nav-item dropdown  compact">
    <a class="nav-link dropdown-toggle" href="#" id="" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi-download" role="img" aria-label="Download">
</i> 
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="">    
        <li>
    <a class="dropdown-item" href="../Example-Quarto-Site-for-R.docx"><i class="bi-file-word" role="img">
</i> 
 Download Docx</a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Example-Quarto-Site-for-R.pdf"><i class="bi-file-pdf" role="img">
</i> 
 Download PDF</a>
  </li>  
    </ul>
  </li>
</ul>
      </div> <!-- /navcollapse -->
  </div> <!-- /container-fluid -->
</nav>
<nav class="quarto-secondary-nav py-2 d-lg-none d-md-block " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <div class="container-fluid d-flex justify-content-between">
    <h1 class="quarto-secondary-nav-title mb-0 fs-3 d-inline">Sample Analysis</h1>
    <button type="button" class="quarto-btn-toggle btn d-lg-none py-0 px-1 d-inline-block border-0 ">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</nav>
</header>
 <!-- /navbar/sidebar -->
<div class="container-fluid quarto-container d-flex flex-column page-layout-article">
<div class="row flex-fill" id="quarto-content">
  <div id="quarto-sidebar" class="col col-12 col-lg-3 d-lg-flex px-0 pt-0 sidebar collapse sidebar-navigation">
    <nav class="me-lg-auto py-2 docked  overflow-scroll">
    <div class="d-flex px-3 mt-2 flex-shrink-0 align-items-center">
      <div class="sidebar-search">
      <form class="d-flex mb-0">
  <input id="quarto-search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>
      </div>
    </div>
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-1 px-3">
      <li class="sidebar-item">
  <a href="../index.html" class=""><span class="chapter-title">Intro</span></a>
</li>
      <li class="sidebar-item">
  <a href="../docs/first.html" class=""><span class="chapter-title">A Basic Quarto Doc</span></a>
</li>
      <li class="sidebar-item">
  <a href="../docs/second.html" class=""><span class="chapter-title">A Pure Python Doc</span></a>
</li>
      <li class="sidebar-item">
  <a href="../docs/third.html" class=""><span class="chapter-title">Example Jupyter Notebook</span></a>
</li>
      <li class="sidebar-item">
  <a href="../docs/four.html" class="active"><span class="chapter-title">Sample Analysis</span></a>
</li>
  </ul>
  </div>
</nav>
  </div>
  <div id="quarto-toc-sidebar" class="col col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-toc order-last"><nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#data" class="nav-link active" data-scroll-target="#data">Data</a></li>
<li><a href="#removing-amoas" class="nav-link" data-scroll-target="#removing-amoas">Removing amoAs</a></li>
<li><a href="#ordination" class="nav-link" data-scroll-target="#ordination">Ordination</a></li>
<li><a href="#arrows" class="nav-link" data-scroll-target="#arrows">Arrows!</a></li>
<li><a href="#statistics" class="nav-link" data-scroll-target="#statistics">Statistics</a>
<ul class="collapse">
<li><a href="#which-factors-have-an-impact-on-overall-community-composition" class="nav-link" data-scroll-target="#which-factors-have-an-impact-on-overall-community-composition">Which factors have an impact on overall community composition?</a></li>
<li><a href="#how-do-the-treatment-factors-affect-the-abundance-of-genes-on-an-individual-level" class="nav-link" data-scroll-target="#how-do-the-treatment-factors-affect-the-abundance-of-genes-on-an-individual-level">How do the treatment factors affect the “abundance” of genes on an individual level?</a></li>
</ul></li>
<li><a href="#biodiversity" class="nav-link" data-scroll-target="#biodiversity">Biodiversity</a></li>
<li><a href="#reading-in-the-best-blast-hit-info" class="nav-link" data-scroll-target="#reading-in-the-best-blast-hit-info">Reading in the best BLAST hit info:</a></li>
<li><a href="#creating-a-phyloseq-object" class="nav-link" data-scroll-target="#creating-a-phyloseq-object">Creating a phyloseq object</a></li>
<li><a href="#richness-analysis" class="nav-link" data-scroll-target="#richness-analysis">Richness analysis</a></li>
<li><a href="#statistical-tests" class="nav-link" data-scroll-target="#statistical-tests">Statistical tests</a>
<ul class="collapse">
<li><a href="#significance-test-of-fertilization-level-on-richness." class="nav-link" data-scroll-target="#significance-test-of-fertilization-level-on-richness.">Significance test of fertilization level on richness.</a></li>
<li><a href="#significance-test-of-fertilization-level-on-richness" class="nav-link" data-scroll-target="#significance-test-of-fertilization-level-on-richness">Significance test of fertilization level on richness</a></li>
</ul></li>
<li><a href="#making-nice-plots-for-stat-differences" class="nav-link" data-scroll-target="#making-nice-plots-for-stat-differences">Making nice plots for stat differences</a></li>
<li><a href="#beta-diversity" class="nav-link" data-scroll-target="#beta-diversity">Beta diversity</a></li>
<li><a href="#composition" class="nav-link" data-scroll-target="#composition">Composition</a></li>
<li><a href="#statistics-on-a-best-blast-hit-level" class="nav-link" data-scroll-target="#statistics-on-a-best-blast-hit-level">Statistics on a best BLAST hit level</a></li>
</ul>
</nav></div>
  <div class="col mx-auto col-sm-12 col-md-9 col-lg-7 col-xl-7 px-lg-4 pe-xxl-4 ps-xxl-0">
<main>
<header id="title-block-header">
<div class="quarto-title-block d-none d-lg-block"><div><h1 class="title d-none d-lg-block">Sample Analysis</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</header>

<div class="cell">

</div>
<p>This is some preliminary analysis I did for an experiment we’re doing to quantify the effects of crop priming on nitrogen fixation rates. You can see the latest version of this analysis <a href="https://pommevilla.github.io/crop_priming/analysis_so_far.html">at my research journal</a> and learn more about the experiment at <a href="https://pommevilla.netlify.app/project/20210823_icrop_priming/">my website</a>. Also note that you can view the source code of this page by click on the <code>Code</code> button to the right of the title of this page.</p>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<div class="cell">
<p></p><details>
<summary>Reading in the data</summary><p></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data.priming <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/priming_amoA_deltaCt.csv"</span>, <span class="at">header =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">sample_id =</span> X) </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>data.raw <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/priming_amoA_rawCt.csv"</span>, <span class="at">header =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">sample_id =</span> X)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>data.priming.long <span class="ot">&lt;-</span> data.priming <span class="sc">%&gt;%</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"amoA"</span>), <span class="at">names_to =</span> <span class="st">"amoA"</span>, <span class="at">values_to =</span> <span class="st">"deltaCT"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>data.raw.long <span class="ot">&lt;-</span> data.raw <span class="sc">%&gt;%</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"amoA"</span>), <span class="at">names_to =</span> <span class="st">"amoA"</span>, <span class="at">values_to =</span> <span class="st">"CT"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>data.priming.long<span class="sc">$</span>sample_id <span class="ot">&lt;-</span> <span class="fu">fct_reorder</span>(data.priming.long<span class="sc">$</span>sample_id, <span class="fu">parse_number</span>(data.priming.long<span class="sc">$</span>sample_id))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> data.priming[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(df) <span class="ot">&lt;-</span> data.priming[, <span class="dv">1</span>]</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fert_level<span class="sc">:</span>field_rep) <span class="sc">%&gt;%</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.factor))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>amoa_counts <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"amoA"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code>data.priming</code> contains the data for our experiment. There are rows for samples, columns for the delta CTs of the different amoAs, and some metadata.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data.priming[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  sample_id  amoA.001 amoA.002  amoA.003  amoA.004
1        2b 10.119249 27.41268  8.764504  8.992937
2       35b  9.837943 27.51089  9.300077 10.445448
3       52f 26.345485 26.34548 26.345485 26.345485
4       34f 26.914432 26.91443 26.914432 26.914432
5       16f  8.337293 25.94591  8.371314 25.945907</code></pre>
</div>
</div>
<p><code>data.raw</code> contains the same columns but lists the raw CT values instead of the 16s-normalized ones.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data.raw[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  sample_id amoA.001 amoA.002 amoA.003 amoA.004
1        2b 22.70657       40 21.35182 21.58026
2       35b 22.32706       40 21.78919 22.93456
3       52f 40.00000       40 40.00000 40.00000
4       34f 40.00000       40 40.00000 40.00000
5       16f 22.39139       40 22.42541 40.00000</code></pre>
</div>
</div>
<p>THe <code>long</code> versions of these dataframes contains the same info but in long format to play nicely with <code>ggplot</code>.</p>
</section>
<section id="removing-amoas" class="level2">
<h2 class="anchored" data-anchor-id="removing-amoas">Removing amoAs</h2>
<p>We’ll start by removing those amoAs from our data that are not present in over 30 samples across both treatments.</p>
<p>We’ll first start by counting the non-detects for each amoA.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>non_detect_counts <span class="ot">&lt;-</span> data.raw.long <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fert_level, amoA) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(CT <span class="sc">==</span> <span class="dv">40</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">non_detect =</span> <span class="st">`</span><span class="at">CT == 40</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(non_detect <span class="sc">==</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finding the amoAs that are not detected in &gt; 30 across both samples</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>removes <span class="ot">&lt;-</span> non_detect_counts <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> fert_level, <span class="at">values_from =</span> n, <span class="at">names_prefix =</span> <span class="st">"fert."</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fert<span class="fl">.0</span> <span class="sc">&gt;</span> <span class="dv">30</span> <span class="sc">&amp;</span> fert<span class="fl">.336</span> <span class="sc">&gt;</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> fert<span class="fl">.0</span><span class="sc">:</span>fert<span class="fl">.336</span>, <span class="at">names_to =</span> <span class="st">"fert_level"</span>, <span class="at">values_to =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll now reduce <code>data.priming</code> by removing those amoAs that are largely non-detects. We’ll also update the <code>long</code> version while we’re at it</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data.priming.reduced <span class="ot">&lt;-</span> data.priming <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(removes<span class="sc">$</span>amoA))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>data.priming.reduced.long <span class="ot">&lt;-</span> data.priming.reduced <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>sample_id, field_rep) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">contains</span>(<span class="st">"amoa"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s a barchart of what we’re removing:</p>
<div class="cell">
<p></p><details>
<summary>Code</summary><p></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>removes <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">amoA =</span> <span class="fu">str_sub</span>(amoA, <span class="sc">-</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">favored =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    amoA <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"006"</span>, <span class="st">"038"</span>, <span class="st">"064"</span>, <span class="st">"069"</span>, <span class="st">"071"</span>) <span class="sc">~</span> <span class="st">"Nothing"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    amoA <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"021"</span>, <span class="st">"028"</span>, <span class="st">"030"</span>, <span class="st">"048"</span>, <span class="st">"073"</span>, <span class="st">"075"</span>, <span class="st">"076"</span>, <span class="st">"077"</span>, <span class="st">"078"</span>) <span class="sc">~</span> <span class="st">"Non-fertilized"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    amoA <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"040"</span>, <span class="st">"050"</span>, <span class="st">"053"</span>) <span class="sc">~</span> <span class="st">"Fourth quadrant"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"First quadrant"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fert_level =</span> <span class="fu">str_sub</span>(fert_level, <span class="at">start =</span> <span class="dv">6</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(amoA, n, <span class="at">fill =</span> favored )) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> fert_level) <span class="sc">+</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"NA"</span>),</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray95"</span>),</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">begin =</span> <span class="dv">0</span>, <span class="at">end =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of samples with &gt; 30 non-detects"</span>,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Fertilizer level"</span>,</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Favored by..."</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that most of the non-detects that we’re removing are from the non-fertilized group.</p>
<p>Next, we’ll convert the CT values to presence/absence for use in later analysis.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>amoA_presence_absence <span class="ot">&lt;-</span> data.raw <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sample_id, <span class="fu">starts_with</span>(<span class="st">"amoA"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"amoA"</span>), <span class="sc">~</span> <span class="fu">ifelse</span>(.x <span class="sc">==</span> <span class="dv">40</span>, <span class="dv">0</span>, <span class="dv">1</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ordination" class="level2">
<h2 class="anchored" data-anchor-id="ordination">Ordination</h2>
<p>Calculating the NMDS (positioning the sites):</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mds.priming <span class="ot">=</span> <span class="fu">metaMDS</span>(data.priming.reduced <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"amoa"</span>)), <span class="at">distance =</span> <span class="st">"bray"</span>, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>site.scores <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scores</span>(mds.priming, <span class="at">display =</span> <span class="st">"sites"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_id =</span> data.priming.reduced<span class="sc">$</span>sample_id,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Crop =</span> data.priming.reduced<span class="sc">$</span>crop,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Fert_Level =</span> <span class="fu">as.factor</span>(data.priming.reduced<span class="sc">$</span>fert_level),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> <span class="fu">as.factor</span>(data.priming.reduced<span class="sc">$</span>doe),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Substrate_Addition =</span> <span class="fu">as.factor</span>(data.priming.reduced<span class="sc">$</span>addition))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is enough to plot a basic NMDS:</p>
<div class="cell">
<p></p><details>
<summary>Plotting the NMDS</summary><p></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>nmds.plot <span class="ot">&lt;-</span> site.scores <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(NMDS1, NMDS2, <span class="at">fill =</span> Fert_Level)) <span class="sc">+</span>  </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.0</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">"grey"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.0</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">"grey"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray95"</span>),</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"Fertilizer Level&lt;br&gt;</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="st">                              &lt;span style = 'font-size:8pt;'&gt;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="st">                              (kg N ha&lt;sup&gt;-1&lt;/sup&gt; y&lt;sup&gt;-1&lt;/sup&gt;)</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="st">                              &lt;/span&gt;"</span>) <span class="sc">+</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">5</span>))</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  )  </span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>nmds.plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also add ellipses to the plot indicate confidence intervals if you’re interested in that:</p>
<div class="cell">
<p></p><details>
<summary>Adding ellipses</summary><p></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>nmds.plot <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(<span class="at">color =</span> Fert_Level), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And again with shading:</p>
<div class="cell">
<p></p><details>
<summary>Adding shading</summary><p></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>nmds.plot <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(<span class="at">color =</span> Fert_Level), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Fert_Level), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="arrows" class="level2">
<h2 class="anchored" data-anchor-id="arrows">Arrows!</h2>
<p>Let’s calculate the loading factors of the individual amoas:</p>
<div class="cell">
<p></p><details>
<summary>Calculating loadings</summary><p></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dune_dist <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(data.priming <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">'amoA'</span>)))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>amoa_anosim <span class="ot">&lt;-</span> <span class="fu">anosim</span>(dune_dist, data.priming<span class="sc">$</span>fert_level)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>mds.spp.fit <span class="ot">&lt;-</span> <span class="fu">envfit</span>(mds.priming, data.priming.reduced <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"amoa"</span>)), <span class="at">permutations =</span> <span class="dv">999</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>spp.scrs <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scores</span>(mds.spp.fit, <span class="at">display =</span> <span class="st">"vectors"</span>)) </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>spp.scrs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spp.scrs, <span class="at">Species =</span> <span class="fu">rownames</span>(spp.scrs)) </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>spp.scrs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spp.scrs, <span class="at">pval =</span> mds.spp.fit<span class="sc">$</span>vectors<span class="sc">$</span>pvals)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>spp.scores <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scores</span>(mds.spp.fit, <span class="at">display =</span> <span class="st">"vectors"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">rownames</span>(.),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">pval =</span> mds.spp.fit<span class="sc">$</span>vectors<span class="sc">$</span>pvals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This is enough to plot arrows on the NMDS. We’ll show the loadings of some amoAs of interest that we identified in a previous analysis.</p>
<div class="cell">
<p></p><details>
<summary>Plotting arrows</summary><p></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>special <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"amoA.012"</span>, <span class="st">"amoA.031"</span>, <span class="st">"amoA.035"</span>, <span class="st">"amoA.042"</span>, <span class="st">"amoA.045"</span>, <span class="st">"amoA.070"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>special_arrows <span class="ot">&lt;-</span> spp.scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rowname <span class="sc">%in%</span> special) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.25</span> <span class="sc">*</span> NMDS1,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.25</span> <span class="sc">*</span> NMDS2,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">assay =</span> <span class="fu">str_sub</span>(rowname, <span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">assay =</span> <span class="fu">paste0</span>(<span class="st">"amoA_AOB_p"</span>, assay)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>nmds.plot <span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="at">data =</span> special_arrows,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="sc">-</span><span class="fl">0.3</span> <span class="sc">*</span> NMDS1,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="sc">-</span><span class="fl">0.3</span> <span class="sc">*</span> NMDS2),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.66</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">"cm"</span>)),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">color =</span> <span class="st">"grey10"</span>, <span class="at">lwd =</span> <span class="fl">0.3</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> special_arrows,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(x <span class="sc">*</span> <span class="dv">1</span>, y <span class="sc">*</span> <span class="dv">1</span>, <span class="at">label =</span> assay),</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">force =</span> <span class="dv">1</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="sc">-</span><span class="fl">0.001</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"ANOSIM R = "</span>, <span class="fu">round</span>(amoa_anosim<span class="sc">$</span>statistic, <span class="dv">2</span>),</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"</span><span class="sc">\n</span><span class="st">p &lt; 0.001"</span>),</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fl">0.4</span>,</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fl">0.25</span>,</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="dv">2</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(<span class="at">color =</span> Fert_Level), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-stderr">
<pre><code>Warning: Duplicated aesthetics after name standardisation: size</code></pre>
</div>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="statistics" class="level2">
<h2 class="anchored" data-anchor-id="statistics">Statistics</h2>
<section id="which-factors-have-an-impact-on-overall-community-composition" class="level3">
<h3 class="anchored" data-anchor-id="which-factors-have-an-impact-on-overall-community-composition">Which factors have an impact on overall community composition?</h3>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> data.priming.reduced <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="fu">contains</span>(<span class="st">"amoa"</span>)))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> data.priming.reduced <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="fu">contains</span>(<span class="st">"amoa"</span>)))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis</span>(Y <span class="sc">~</span> X<span class="sc">$</span>fert_level <span class="sc">+</span> X<span class="sc">$</span>addition <span class="sc">+</span> X<span class="sc">$</span>crop <span class="sc">+</span> X<span class="sc">$</span>timepoint) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
Call:
adonis(formula = Y ~ X$fert_level + X$addition + X$crop + X$timepoint) 

Permutation: free
Number of permutations: 999

Terms added sequentially (first to last)

             Df SumsOfSqs MeanSqs F.Model      R2 Pr(&gt;F)    
X$fert_level  1    1.4426 1.44255  56.092 0.37093  0.001 ***
X$addition    2    0.0327 0.01633   0.635 0.00840  0.680    
X$crop        1    0.0882 0.08823   3.431 0.02269  0.036 *  
X$timepoint   1    0.0367 0.03671   1.427 0.00944  0.214    
Residuals    89    2.2889 0.02572         0.58855           
Total        94    3.8890                 1.00000           
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>This tells us that fertilization level is very significant and explains ~37% of the variation in our samples. Crop is also a significant factor on community composition, though it only explains 2.3% of the variation.</p>
</section>
<section id="how-do-the-treatment-factors-affect-the-abundance-of-genes-on-an-individual-level" class="level3">
<h3 class="anchored" data-anchor-id="how-do-the-treatment-factors-affect-the-abundance-of-genes-on-an-individual-level">How do the treatment factors affect the “abundance” of genes on an individual level?</h3>
<p>All the code below does is perform an ANOVA of the gene’s abundance against all the terms and all of their interactions.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>formulae <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">colnames</span>(data.priming.reduced <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"amoA"</span>))), <span class="cf">function</span>(x) <span class="fu">as.formula</span>(<span class="fu">paste0</span>(x, <span class="st">" ~ fert_level * crop * timepoint * addition"</span>)))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(formulae, <span class="cf">function</span>(x) broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="fu">aov</span>(x, <span class="at">data =</span> data.priming.reduced)))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(res) <span class="ot">&lt;-</span> <span class="fu">format</span>(formulae)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(res) <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(<span class="fu">names</span>(res), <span class="at">end =</span> <span class="dv">8</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>anova_results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(res), <span class="cf">function</span>(i) res[[i]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">gene =</span> <span class="fu">names</span>(res)[[i]])) <span class="sc">%&gt;%</span> </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"Residuals"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sig =</span> <span class="fu">case_when</span>(</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    p.value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> p.value <span class="sc">&gt;</span> <span class="fl">0.01</span> <span class="sc">~</span> <span class="st">"*"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    p.value <span class="sc">&lt;</span> <span class="fl">0.01</span> <span class="sc">&amp;</span> p.value <span class="sc">&gt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"**"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    p.value <span class="sc">&lt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"***"</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NS"</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualization:</p>
<div class="cell">
<p></p><details>
<summary>ANOVA visualization</summary><p></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>anova_results <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gene =</span> <span class="fu">str_sub</span>(gene, <span class="sc">-</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(gene, term, <span class="at">fill =</span> sig)) <span class="sc">+</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"amoA"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Summary of ANOVA results"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Significance "</span>) <span class="sc">+</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Overall, we see that, again, fertilization level has a significant impact on abundance levels of the individual genes, and it’s not even really that close. There are other factors that might be worth investigating on a gene-by-gene basis, too, but that’s for later.</p>
</section>
</section>
<section id="biodiversity" class="level2">
<h2 class="anchored" data-anchor-id="biodiversity">Biodiversity</h2>
<p>Let’s start by visualizing the presence/absence table:</p>
<div class="cell">
<p></p><details>
<summary>Presence/absence plot</summary><p></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>amoA_presence_absence <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"amoA"</span>), <span class="at">names_to =</span> <span class="st">"amoA"</span>, <span class="at">values_to =</span> <span class="st">"presence"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">amoA =</span> <span class="fu">str_sub</span>(amoA, <span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">amoA =</span> <span class="fu">paste0</span>(<span class="st">"amoA_AOB_p"</span>, amoA),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">presence =</span> <span class="fu">as.factor</span>(presence)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(metadata <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">strip_label =</span> <span class="fu">paste0</span>(fert_level, <span class="st">" kg N ha&lt;sup&gt;-1&lt;/sup&gt; y&lt;sup&gt;-1&lt;/sup&gt;"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sample_id, amoA, <span class="at">fill =</span> presence)) <span class="sc">+</span> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Sample name"</span>,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Primer pair"</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Species is:"</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">""</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Absent"</span>, <span class="st">"Present"</span>),</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">begin =</span> <span class="dv">0</span>, <span class="at">end =</span> <span class="dv">1</span>,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">option =</span> <span class="st">"magma"</span>) <span class="sc">+</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="fl">0.25</span>),</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"blaCk"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">"cm"</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> strip_label, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="reading-in-the-best-blast-hit-info" class="level2">
<h2 class="anchored" data-anchor-id="reading-in-the-best-blast-hit-info">Reading in the best BLAST hit info:</h2>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>amoA_organism_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"data/amoa_mfp_qpcr_org_accessions.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"forward"</span>, <span class="st">"reverse"</span>, <span class="st">"notes"</span>)))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Counts of best BLAST hits:</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>amoA_organism_info <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(best_blast_hits, <span class="at">sort =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 25 x 2
   best_blast_hits                               n
   &lt;chr&gt;                                     &lt;int&gt;
 1 Nitrosolobus multiformis AmoA (amoA) gene    10
 2 Nitrosospira sp. En13 AmoA                    9
 3 Nitrosospira multiformis ATCC 25196           7
 4 Nitrosospira sp. Wyke8 AmoA                   7
 5 Nitrosospira lacus strain APG3                6
 6 Nitrosospira sp. Np39-19                      6
 7 Nitrosospira sp. Wyke2                        4
 8 Nitrosospira sp. NpAV                         3
 9 Nitrosomonas sp. JL21                         2
10 Nitrosospira briensis                         2
# ... with 15 more rows</code></pre>
</div>
</div>
</section>
<section id="creating-a-phyloseq-object" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-phyloseq-object">Creating a phyloseq object</h2>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>amoa_tax_table <span class="ot">&lt;-</span> amoA_organism_info <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(array_name, best_blast_hits) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"array_name"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_table</span>()</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(amoa_tax_table) <span class="ot">&lt;-</span> amoA_organism_info<span class="sc">$</span>array_name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ps <span class="ot">&lt;-</span> <span class="fu">phyloseq</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">otu_table</span>(amoA_presence_absence <span class="sc">%&gt;%</span> <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"sample_id"</span>), <span class="at">taxa_are_rows =</span> <span class="cn">FALSE</span>),</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_data</span>(metadata),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  amoa_tax_table</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="richness-analysis" class="level2">
<h2 class="anchored" data-anchor-id="richness-analysis">Richness analysis</h2>
<p>How does observed richness and evenness change with treatment level? This is a modified diversity function that does a bunch of nice stuff that <code>phyloseq::estimate_richness</code> doesn’t do.</p>
<div class="cell">
<p></p><details>
<summary>Estimate richness function</summary><p></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>estimate_richness_mod <span class="ot">&lt;-</span> <span class="cf">function</span>(physeq, <span class="at">split=</span><span class="cn">TRUE</span>, <span class="at">measures=</span><span class="cn">NULL</span>){</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="sc">!</span>split ){</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    OTU <span class="ot">&lt;-</span> <span class="fu">taxa_sums</span>(physeq)        </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>( split ){</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    OTU <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">otu_table</span>(physeq), <span class="st">"matrix"</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( <span class="fu">taxa_are_rows</span>(physeq) ){ OTU <span class="ot">&lt;-</span> <span class="fu">t</span>(OTU) }</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  renamevec <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Chao1"</span>, <span class="st">"ACE"</span>, <span class="st">"Shannon"</span>, <span class="st">"Pielou"</span>, <span class="st">"Simpson"</span>, <span class="st">"InvSimpson"</span>, <span class="st">"SimpsonE"</span>, <span class="st">"Fisher"</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(renamevec) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"S.obs"</span>, <span class="st">"S.chao1"</span>, <span class="st">"S.ACE"</span>, <span class="st">"shannon"</span>, <span class="st">"pielou"</span>, <span class="st">"simpson"</span>, <span class="st">"invsimpson"</span>, <span class="st">"simpsone"</span>, <span class="st">"fisher"</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">is.null</span>(measures) ){</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    measures <span class="ot">=</span> <span class="fu">as.character</span>(renamevec)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">any</span>(measures <span class="sc">%in%</span> <span class="fu">names</span>(renamevec)) ){</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    measures[measures <span class="sc">%in%</span> <span class="fu">names</span>(renamevec)] <span class="ot">&lt;-</span> renamevec[<span class="fu">names</span>(renamevec) <span class="sc">%in%</span> measures]</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="sc">!</span><span class="fu">any</span>(measures <span class="sc">%in%</span> renamevec) ){</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"None of the `measures` you provided are supported. Try default `NULL` instead."</span>)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>  outlist <span class="ot">=</span> <span class="fu">vector</span>(<span class="st">"list"</span>)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>  estimRmeas <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Chao1"</span>, <span class="st">"Observed"</span>, <span class="st">"ACE"</span>)</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">any</span>(estimRmeas <span class="sc">%in%</span> measures) ){</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(<span class="fu">t</span>(<span class="fu">data.frame</span>(<span class="fu">estimateR</span>(OTU)))))</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="st">"Shannon"</span> <span class="sc">%in%</span> measures ){</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(<span class="at">shannon =</span> <span class="fu">diversity</span>(OTU, <span class="at">index=</span><span class="st">"shannon"</span>)))</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="st">"Pielou"</span> <span class="sc">%in%</span> measures){</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print("Starting Pielou")</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(<span class="at">pielou =</span> <span class="fu">diversity</span>(OTU, <span class="at">index =</span> <span class="st">"shannon"</span>)<span class="sc">/</span><span class="fu">log</span>(<span class="fu">estimateR</span>(OTU)[<span class="st">"S.obs"</span>,])))</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="st">"Simpson"</span> <span class="sc">%in%</span> measures ){</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>    outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(<span class="at">simpson =</span> <span class="fu">diversity</span>(OTU, <span class="at">index=</span><span class="st">"simpson"</span>)))</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="st">"InvSimpson"</span> <span class="sc">%in%</span> measures ){</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>    outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(<span class="at">invsimpson =</span> <span class="fu">diversity</span>(OTU, <span class="at">index=</span><span class="st">"invsimpson"</span>)))</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="st">"SimpsonE"</span> <span class="sc">%in%</span> measures ){</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>    outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(<span class="at">simpsone =</span> <span class="fu">diversity</span>(OTU, <span class="at">index=</span><span class="st">"invsimpson"</span>)<span class="sc">/</span><span class="fu">estimateR</span>(OTU)[<span class="st">"S.obs"</span>,]))</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="st">"Fisher"</span> <span class="sc">%in%</span> measures ){</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>    fisher <span class="ot">=</span> <span class="fu">tryCatch</span>(<span class="fu">fisher.alpha</span>(OTU, <span class="at">se=</span><span class="cn">TRUE</span>),</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>                      <span class="at">warning=</span><span class="cf">function</span>(w){</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">warning</span>(<span class="st">"phyloseq::estimate_richness: Warning in fisher.alpha(). See `?fisher.fit` or ?`fisher.alpha`. Treat fisher results with caution"</span>)</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">suppressWarnings</span>(<span class="fu">fisher.alpha</span>(OTU, <span class="at">se=</span><span class="cn">TRUE</span>)[, <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"se"</span>)])</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>                      }</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">dim</span>(fisher))){</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(fisher)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fisher"</span>, <span class="st">"se.fisher"</span>)</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>      outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(fisher))</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>      outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="at">Fisher=</span><span class="fu">list</span>(fisher))</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">=</span> <span class="fu">do.call</span>(<span class="st">"cbind"</span>, outlist)</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>  namechange <span class="ot">=</span> <span class="fu">intersect</span>(<span class="fu">colnames</span>(out), <span class="fu">names</span>(renamevec))</span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(out)[<span class="fu">colnames</span>(out) <span class="sc">%in%</span> namechange] <span class="ot">&lt;-</span> renamevec[namechange]</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>  colkeep <span class="ot">=</span> <span class="fu">sapply</span>(<span class="fu">paste0</span>(<span class="st">"(se</span><span class="sc">\\</span><span class="st">.){0,}"</span>, measures), grep, <span class="fu">colnames</span>(out), <span class="at">ignore.case=</span><span class="cn">TRUE</span>)</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">=</span> out[, <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">unlist</span>(colkeep))), drop<span class="ot">=</span><span class="cn">FALSE</span>]</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(out)</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<p></p><details>
<summary>Calculate richnesses for sample groups</summary><p></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Shannon"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>richness <span class="ot">&lt;-</span> <span class="fu">estimate_richness_mod</span>(ps, <span class="at">measures =</span> metrics) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_id =</span> <span class="fu">str_sub</span>(sample_id, <span class="at">start =</span> <span class="dv">2</span>)) </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>richness <span class="ot">&lt;-</span> <span class="fu">left_join</span>(<span class="fu">sample_data</span>(ps) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_id"</span>), richness) <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Observed<span class="sc">:</span>Shannon, <span class="at">names_to =</span> <span class="st">"Metric"</span>, <span class="at">values_to =</span> <span class="st">"Value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-stderr">
<pre><code>Joining, by = "sample_id"</code></pre>
</div>
</div>
</section>
<section id="statistical-tests" class="level2">
<h2 class="anchored" data-anchor-id="statistical-tests">Statistical tests</h2>
<section id="significance-test-of-fertilization-level-on-richness." class="level3">
<h3 class="anchored" data-anchor-id="significance-test-of-fertilization-level-on-richness.">Significance test of fertilization level on richness.</h3>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(sig_rich_fert <span class="ot">&lt;-</span> <span class="fu">kruskal.test</span>(Value <span class="sc">~</span> fert_level, <span class="at">data =</span> richness <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Metric <span class="sc">==</span> <span class="st">"Observed"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
    Kruskal-Wallis rank sum test

data:  Value by fert_level
Kruskal-Wallis chi-squared = 54.212, df = 1, p-value = 1.8e-13</code></pre>
</div>
</div>
<p>The <code>p-value &lt; 0.001</code> gives us strong statistical evidence that richness is significantly different between fertilization treatment groups.</p>
</section>
<section id="significance-test-of-fertilization-level-on-richness" class="level3">
<h3 class="anchored" data-anchor-id="significance-test-of-fertilization-level-on-richness">Significance test of fertilization level on richness</h3>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>(sig_even_fert <span class="ot">&lt;-</span> <span class="fu">kruskal.test</span>(Value <span class="sc">~</span> fert_level, <span class="at">data =</span> richness <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Metric <span class="sc">==</span> <span class="st">"Shannon"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
    Kruskal-Wallis rank sum test

data:  Value by fert_level
Kruskal-Wallis chi-squared = 54.268, df = 1, p-value = 1.75e-13</code></pre>
</div>
</div>
<p>The <code>p-value &lt; 0.001</code> gives us strong statistical evidence that Shannon diversity is significantly different between fertilization treatment groups.</p>
</section>
</section>
<section id="making-nice-plots-for-stat-differences" class="level2">
<h2 class="anchored" data-anchor-id="making-nice-plots-for-stat-differences">Making nice plots for stat differences</h2>
<p>Standard deviations, mean</p>
<div class="cell">
<p></p><details>
<summary>Generate alpha diversity plots</summary><p></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>summaries <span class="ot">&lt;-</span> richness <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Metric, fert_level) <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_val =</span> <span class="fu">mean</span>(Value), </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_val =</span> <span class="fu">sd</span>(Value),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se =</span> <span class="fu">abs</span>((sd_val <span class="sc">/</span> <span class="fu">sqrt</span>(n)) <span class="sc">*</span> <span class="fu">qt</span>(<span class="fl">0.025</span>, n <span class="sc">-</span> <span class="dv">1</span>) )) <span class="sc">%&gt;%</span> </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ymax =</span> mean_val <span class="sc">+</span> se, </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">ymin =</span> mean_val <span class="sc">-</span> se) </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>this_annotation <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Shannon"</span>),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">lab =</span> <span class="fu">c</span>(<span class="st">"***"</span>, <span class="st">"***"</span>),</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fl">1.5</span>,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">50</span> <span class="sc">+</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">2</span>, <span class="dv">4</span> <span class="sc">+</span> <span class="fl">0.5</span>),</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">lineheights =</span> <span class="fu">c</span>(<span class="dv">50</span> <span class="sc">+</span> <span class="dv">5</span>, <span class="dv">4</span> <span class="sc">+</span> <span class="fl">0.25</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>summaries <span class="sc">%&gt;%</span>  </span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(fert_level, mean_val, <span class="at">fill =</span> fert_level)) <span class="sc">+</span> </span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Metric, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> </span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>),</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"NA"</span>)</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>))) <span class="sc">+</span> </span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> this_annotation,</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> lab),</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> this_annotation,</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>,</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> <span class="dv">2</span>, </span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> lineheights,</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yend =</span> lineheights),</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>               <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fertilization Level</span><span class="sc">\n</span><span class="st">(*** = p &lt; 0.001 by Kruskal Wallis)"</span>,</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Alpha diversity metrics by fertilization level"</span></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="beta-diversity" class="level2">
<h2 class="anchored" data-anchor-id="beta-diversity">Beta diversity</h2>
<p>We’ll start beta diversity analysis off by doing an ADONIS/PERMANOVA to determine if treatment centroids/treatment variations are different between groups.</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>dis <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(<span class="fu">otu_table</span>(ps))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">sample_data</span>(ps)<span class="sc">$</span>fert_level</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(dis, groups)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
          Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
Groups     1 0.52595 0.52595  24.589 3.228e-06 ***
Residuals 92 1.96781 0.02139                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Since <code>p &lt;&lt;&lt;&lt; 0.0001</code>, there is strong evidence that the overall community compositions are significantly different (treatment centroid, distance to centroid, community variation) between the two groups. W can visualize this with a 1 SD ellipse:</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">ellipse =</span> <span class="cn">TRUE</span>, <span class="at">hull =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that there is clear separation between the two treatment centroids. Let’s do some more analysis on the distance-to-centroids that we’re seeing:</p>
<div class="cell">
<p></p><details>
<summary>Distance-to-centroid plots</summary><p></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>betadistances <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_frame =</span> mod<span class="sc">$</span>group,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> mod<span class="sc">$</span>distances</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>betadistances <span class="sc">%&gt;%</span> </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(time_frame, distance)) <span class="sc">+</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">fill =</span> time_frame), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">"cm"</span>),</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">""</span>,</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Distance to centroid"</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  ggsignif<span class="sc">::</span><span class="fu">geom_signif</span>(</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">map_signif_level =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">comparisons =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"336"</span>)),</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> <span class="st">"t.test"</span>,</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">step_increase =</span> <span class="fl">0.1</span>,</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">textsize =</span> <span class="dv">5</span>,</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">tip_length =</span> <span class="dv">0</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The significance bar is coming from the PERMANOVA test we did above. We see that there is actually less beta diversity (as meaasured by distance-to-centroid) in the fertilized group than in the non- fertilized group. We’ll see another visualization backing this up in the next section:</p>
</section>
<section id="composition" class="level2">
<h2 class="anchored" data-anchor-id="composition">Composition</h2>
<p>Let’s visualize the composition of the communities, separated by fertilization. We’ll start with raw counts - how many times was that best BLAST hit seen in that sample?</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">comp_barplot</span>(ps, <span class="st">"ta1"</span>,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">facet_by =</span> <span class="st">"fert_level"</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample_order =</span>  <span class="st">"default"</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">tax_transform_for_plot =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Sample composition by fertilization level"</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"(raw counts)"</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="sc">-</span><span class="dv">7</span>)),</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Best BLAST hit"</span>, <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that overall the fertilized group appears to have more richness in it.</p>
<p>How about sample composition? IE, relative abundances?</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">comp_barplot</span>(ps, <span class="st">"ta1"</span>,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">facet_by =</span> <span class="st">"fert_level"</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample_order =</span>  <span class="st">"default"</span>) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Sample composition by fertilization level"</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"(relative abundance)"</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="sc">-</span><span class="dv">7</span>)),</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Best BLAST hit"</span>, <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Two big things pop out:</p>
<ul>
<li>Species distribution is more even in the fertilized group. This makes sense given previous results showing that Shannon entropy is higher and beta diversity is lower in the fertilized group. You can also see that the communities just look more like each other in the fertilized group, which manifests in shorter distance-to-centroids/lower community variation.</li>
<li>There’s more green in the fertilized group, suggesting that Nitrosolobus multiformus and Nitrosospira sp. En13 abundances are significantly affected by fertilization addition.</li>
</ul>
</section>
<section id="statistics-on-a-best-blast-hit-level" class="level2">
<h2 class="anchored" data-anchor-id="statistics-on-a-best-blast-hit-level">Statistics on a best BLAST hit level</h2>
<p>The next chunk is just doing some data transformation stuff to count the number of times each organism was seen in each sample in preparation for the statistical analysis.</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pa_count <span class="ot">&lt;-</span> ps <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">otu_table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  data.frame <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"amoA"</span>)) </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>org_table <span class="ot">&lt;-</span> <span class="fu">tax_table</span>(ps) <span class="sc">%&gt;%</span> </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"name"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">bbh =</span> ta1) <span class="sc">%&gt;%</span> </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cleaned_names =</span> janitor<span class="sc">::</span><span class="fu">make_clean_names</span>(bbh))</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>bbh_sample_counts <span class="ot">&lt;-</span> <span class="fu">left_join</span>(pa_count, org_table, <span class="at">by =</span> <span class="st">"name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sample_id, bbh) <span class="sc">%&gt;%</span> </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"bbh"</span>, <span class="at">values_from =</span> value)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>bbh_level_counts <span class="ot">&lt;-</span> <span class="fu">left_join</span>(bbh_sample_counts,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sample_data</span>(ps) <span class="sc">%&gt;%</span> </span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>            data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">'sample_id'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">right_join</span>(bbh_sample_counts)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we’re preparing formulas to feed to a <code>lapply</code> function to perform a Kruskal-Wallis test on all of the organisms.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>formulae <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">colnames</span>(bbh_sample_counts <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>sample_id) <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>()) , <span class="cf">function</span>(x) <span class="fu">as.formula</span>(<span class="fu">paste0</span>(x, <span class="st">" ~ fert_level * crop * timepoint * addition"</span>)))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>formulae[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(formulae, <span class="cf">function</span>(x) broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="fu">aov</span>(x, <span class="at">data =</span> bbh_level_counts <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>())))</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(res) <span class="ot">&lt;-</span> <span class="fu">format</span>(formulae)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(res) <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(res), <span class="cf">function</span>(x) <span class="fu">str_split</span>(x, <span class="st">"~"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>anova_results.counts <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(res), <span class="cf">function</span>(i) res[[i]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">gene =</span> <span class="fu">names</span>(res)[[i]])) <span class="sc">%&gt;%</span> </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"Residuals"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gene =</span> <span class="fu">str_trim</span>(gene))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualizing the results again:</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>anova_results.counts <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(org_table, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"gene"</span> <span class="ot">=</span><span class="st">"cleaned_names"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sig =</span> <span class="fu">case_when</span>(</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    p.value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> p.value <span class="sc">&gt;</span> <span class="fl">0.01</span> <span class="sc">~</span> <span class="st">"*"</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    p.value <span class="sc">&lt;</span> <span class="fl">0.01</span> <span class="sc">&amp;</span> p.value <span class="sc">&gt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"**"</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    p.value <span class="sc">&lt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"***"</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NS"</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(term, bbh, <span class="at">fill =</span> sig)) <span class="sc">+</span> </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Summary of ANOVA results"</span>,</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Significance "</span>) <span class="sc">+</span> </span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>()</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> rev) <span class="sc">+</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="four_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see the same pattern at the organism level as when we did this at the gene level: fertilization level is by far the most significant factor affecting Presence/Absence of organisms.</p>

<!-- -->
<div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title anchored" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb45" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Sample Analysis"</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(microViz)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phyloseq)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>This is some preliminary analysis I did for an experiment we're doing to quantify the effects of crop priming on nitrogen fixation rates.</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>You can see the latest version of this analysis <span class="co">[</span><span class="ot">at my research journal</span><span class="co">](https://pommevilla.github.io/crop_priming/analysis_so_far.html)</span> and learn more about the experiment at <span class="co">[</span><span class="ot">my website</span><span class="co">](https://pommevilla.netlify.app/project/20210823_icrop_priming/)</span>.</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>Also note that you can view the source code of this page by click on the <span class="in">`Code`</span> button to the right of the title of this page.</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Reading in the data"</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>data.priming <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/priming_amoA_deltaCt.csv"</span>, <span class="at">header =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">sample_id =</span> X) </span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>data.raw <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/priming_amoA_rawCt.csv"</span>, <span class="at">header =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">sample_id =</span> X)</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>data.priming.long <span class="ot">&lt;-</span> data.priming <span class="sc">%&gt;%</span> </span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"amoA"</span>), <span class="at">names_to =</span> <span class="st">"amoA"</span>, <span class="at">values_to =</span> <span class="st">"deltaCT"</span>)</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a>data.raw.long <span class="ot">&lt;-</span> data.raw <span class="sc">%&gt;%</span> </span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"amoA"</span>), <span class="at">names_to =</span> <span class="st">"amoA"</span>, <span class="at">values_to =</span> <span class="st">"CT"</span>)</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>data.priming.long<span class="sc">$</span>sample_id <span class="ot">&lt;-</span> <span class="fu">fct_reorder</span>(data.priming.long<span class="sc">$</span>sample_id, <span class="fu">parse_number</span>(data.priming.long<span class="sc">$</span>sample_id))</span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> data.priming[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(df) <span class="ot">&lt;-</span> data.priming[, <span class="dv">1</span>]</span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fert_level<span class="sc">:</span>field_rep) <span class="sc">%&gt;%</span></span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.factor))</span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a>amoa_counts <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"amoA"</span>))</span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a><span class="in">`data.priming`</span> contains the data for our experiment. There are rows for samples, columns for the </span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a>delta CTs of the different amoAs, and some metadata.</span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a>data.priming[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a><span class="in">`data.raw`</span> contains the same columns but lists the raw CT values instead of the 16s-normalized ones.</span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-73"><a href="#cb45-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a>data.raw[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a>THe <span class="in">`long`</span> versions of these dataframes contains the same info but in long format to play nicely</span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a>with <span class="in">`ggplot`</span>.</span>
<span id="cb45-79"><a href="#cb45-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-80"><a href="#cb45-80" aria-hidden="true" tabindex="-1"></a><span class="fu">## Removing amoAs</span></span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a>We'll start by removing those amoAs from our data that are not present in over 30 samples across both treatments.</span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-84"><a href="#cb45-84" aria-hidden="true" tabindex="-1"></a>We'll first start by counting the non-detects for each amoA.</span>
<span id="cb45-85"><a href="#cb45-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-88"><a href="#cb45-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-89"><a href="#cb45-89" aria-hidden="true" tabindex="-1"></a>non_detect_counts <span class="ot">&lt;-</span> data.raw.long <span class="sc">%&gt;%</span></span>
<span id="cb45-90"><a href="#cb45-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fert_level, amoA) <span class="sc">%&gt;%</span> </span>
<span id="cb45-91"><a href="#cb45-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(CT <span class="sc">==</span> <span class="dv">40</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-92"><a href="#cb45-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">non_detect =</span> <span class="st">`</span><span class="at">CT == 40</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-93"><a href="#cb45-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(non_detect <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-94"><a href="#cb45-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-95"><a href="#cb45-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-96"><a href="#cb45-96" aria-hidden="true" tabindex="-1"></a>Finding the amoAs that are not detected in &gt; 30 across both samples</span>
<span id="cb45-97"><a href="#cb45-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-100"><a href="#cb45-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-101"><a href="#cb45-101" aria-hidden="true" tabindex="-1"></a>removes <span class="ot">&lt;-</span> non_detect_counts <span class="sc">%&gt;%</span> </span>
<span id="cb45-102"><a href="#cb45-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> fert_level, <span class="at">values_from =</span> n, <span class="at">names_prefix =</span> <span class="st">"fert."</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-103"><a href="#cb45-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fert<span class="fl">.0</span> <span class="sc">&gt;</span> <span class="dv">30</span> <span class="sc">&amp;</span> fert<span class="fl">.336</span> <span class="sc">&gt;</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-104"><a href="#cb45-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> fert<span class="fl">.0</span><span class="sc">:</span>fert<span class="fl">.336</span>, <span class="at">names_to =</span> <span class="st">"fert_level"</span>, <span class="at">values_to =</span> <span class="st">"n"</span>)</span>
<span id="cb45-105"><a href="#cb45-105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-106"><a href="#cb45-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-107"><a href="#cb45-107" aria-hidden="true" tabindex="-1"></a>We'll now reduce <span class="in">`data.priming`</span> by removing those amoAs that are largely non-detects. </span>
<span id="cb45-108"><a href="#cb45-108" aria-hidden="true" tabindex="-1"></a>We'll also update the <span class="in">`long`</span> version while we're at it</span>
<span id="cb45-109"><a href="#cb45-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-112"><a href="#cb45-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-113"><a href="#cb45-113" aria-hidden="true" tabindex="-1"></a>data.priming.reduced <span class="ot">&lt;-</span> data.priming <span class="sc">%&gt;%</span> </span>
<span id="cb45-114"><a href="#cb45-114" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(removes<span class="sc">$</span>amoA))</span>
<span id="cb45-115"><a href="#cb45-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-116"><a href="#cb45-116" aria-hidden="true" tabindex="-1"></a>data.priming.reduced.long <span class="ot">&lt;-</span> data.priming.reduced <span class="sc">%&gt;%</span> </span>
<span id="cb45-117"><a href="#cb45-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>sample_id, field_rep) <span class="sc">%&gt;%</span> </span>
<span id="cb45-118"><a href="#cb45-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">contains</span>(<span class="st">"amoa"</span>)) </span>
<span id="cb45-119"><a href="#cb45-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-120"><a href="#cb45-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-121"><a href="#cb45-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-122"><a href="#cb45-122" aria-hidden="true" tabindex="-1"></a>Here's a barchart of what we're removing:</span>
<span id="cb45-123"><a href="#cb45-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-126"><a href="#cb45-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-127"><a href="#cb45-127" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-128"><a href="#cb45-128" aria-hidden="true" tabindex="-1"></a>removes <span class="sc">%&gt;%</span> </span>
<span id="cb45-129"><a href="#cb45-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">amoA =</span> <span class="fu">str_sub</span>(amoA, <span class="sc">-</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-130"><a href="#cb45-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">favored =</span> <span class="fu">case_when</span>(</span>
<span id="cb45-131"><a href="#cb45-131" aria-hidden="true" tabindex="-1"></a>    amoA <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"006"</span>, <span class="st">"038"</span>, <span class="st">"064"</span>, <span class="st">"069"</span>, <span class="st">"071"</span>) <span class="sc">~</span> <span class="st">"Nothing"</span>,</span>
<span id="cb45-132"><a href="#cb45-132" aria-hidden="true" tabindex="-1"></a>    amoA <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"021"</span>, <span class="st">"028"</span>, <span class="st">"030"</span>, <span class="st">"048"</span>, <span class="st">"073"</span>, <span class="st">"075"</span>, <span class="st">"076"</span>, <span class="st">"077"</span>, <span class="st">"078"</span>) <span class="sc">~</span> <span class="st">"Non-fertilized"</span>,</span>
<span id="cb45-133"><a href="#cb45-133" aria-hidden="true" tabindex="-1"></a>    amoA <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"040"</span>, <span class="st">"050"</span>, <span class="st">"053"</span>) <span class="sc">~</span> <span class="st">"Fourth quadrant"</span>,</span>
<span id="cb45-134"><a href="#cb45-134" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"First quadrant"</span></span>
<span id="cb45-135"><a href="#cb45-135" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb45-136"><a href="#cb45-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fert_level =</span> <span class="fu">str_sub</span>(fert_level, <span class="at">start =</span> <span class="dv">6</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-137"><a href="#cb45-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(amoA, n, <span class="at">fill =</span> favored )) <span class="sc">+</span></span>
<span id="cb45-138"><a href="#cb45-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb45-139"><a href="#cb45-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> fert_level) <span class="sc">+</span> </span>
<span id="cb45-140"><a href="#cb45-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb45-141"><a href="#cb45-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb45-142"><a href="#cb45-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb45-143"><a href="#cb45-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb45-144"><a href="#cb45-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"NA"</span>),</span>
<span id="cb45-145"><a href="#cb45-145" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray95"</span>),</span>
<span id="cb45-146"><a href="#cb45-146" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-147"><a href="#cb45-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-148"><a href="#cb45-148" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-149"><a href="#cb45-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span>
<span id="cb45-150"><a href="#cb45-150" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb45-151"><a href="#cb45-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">begin =</span> <span class="dv">0</span>, <span class="at">end =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb45-152"><a href="#cb45-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb45-153"><a href="#cb45-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb45-154"><a href="#cb45-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb45-155"><a href="#cb45-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-156"><a href="#cb45-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of samples with &gt; 30 non-detects"</span>,</span>
<span id="cb45-157"><a href="#cb45-157" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Fertilizer level"</span>,</span>
<span id="cb45-158"><a href="#cb45-158" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Favored by..."</span></span>
<span id="cb45-159"><a href="#cb45-159" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-160"><a href="#cb45-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-161"><a href="#cb45-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-162"><a href="#cb45-162" aria-hidden="true" tabindex="-1"></a>Note that most of the non-detects that we're removing are from the non-fertilized group.</span>
<span id="cb45-163"><a href="#cb45-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-164"><a href="#cb45-164" aria-hidden="true" tabindex="-1"></a>Next, we'll convert the CT values to presence/absence for use in later analysis.</span>
<span id="cb45-165"><a href="#cb45-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-168"><a href="#cb45-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-169"><a href="#cb45-169" aria-hidden="true" tabindex="-1"></a>amoA_presence_absence <span class="ot">&lt;-</span> data.raw <span class="sc">%&gt;%</span> </span>
<span id="cb45-170"><a href="#cb45-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sample_id, <span class="fu">starts_with</span>(<span class="st">"amoA"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-171"><a href="#cb45-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"amoA"</span>), <span class="sc">~</span> <span class="fu">ifelse</span>(.x <span class="sc">==</span> <span class="dv">40</span>, <span class="dv">0</span>, <span class="dv">1</span>))) </span>
<span id="cb45-172"><a href="#cb45-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-173"><a href="#cb45-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-174"><a href="#cb45-174" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ordination</span></span>
<span id="cb45-175"><a href="#cb45-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-176"><a href="#cb45-176" aria-hidden="true" tabindex="-1"></a>Calculating the NMDS (positioning the sites):</span>
<span id="cb45-177"><a href="#cb45-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-178"><a href="#cb45-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE, results='hide'}</span></span>
<span id="cb45-179"><a href="#cb45-179" aria-hidden="true" tabindex="-1"></a><span class="in">mds.priming = metaMDS(data.priming.reduced %&gt;% select(contains("amoa")), distance = "bray", k = 3)</span></span>
<span id="cb45-180"><a href="#cb45-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-181"><a href="#cb45-181" aria-hidden="true" tabindex="-1"></a><span class="in">site.scores &lt;- as.data.frame(scores(mds.priming, display = "sites")) %&gt;% </span></span>
<span id="cb45-182"><a href="#cb45-182" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(sample_id = data.priming.reduced$sample_id,</span></span>
<span id="cb45-183"><a href="#cb45-183" aria-hidden="true" tabindex="-1"></a><span class="in">         Crop = data.priming.reduced$crop,</span></span>
<span id="cb45-184"><a href="#cb45-184" aria-hidden="true" tabindex="-1"></a><span class="in">         Fert_Level = as.factor(data.priming.reduced$fert_level),</span></span>
<span id="cb45-185"><a href="#cb45-185" aria-hidden="true" tabindex="-1"></a><span class="in">         Day = as.factor(data.priming.reduced$doe),</span></span>
<span id="cb45-186"><a href="#cb45-186" aria-hidden="true" tabindex="-1"></a><span class="in">         Substrate_Addition = as.factor(data.priming.reduced$addition))</span></span>
<span id="cb45-187"><a href="#cb45-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-188"><a href="#cb45-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-189"><a href="#cb45-189" aria-hidden="true" tabindex="-1"></a>This is enough to plot a basic NMDS:</span>
<span id="cb45-190"><a href="#cb45-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-193"><a href="#cb45-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-194"><a href="#cb45-194" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-195"><a href="#cb45-195" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Plotting the NMDS"</span></span>
<span id="cb45-196"><a href="#cb45-196" aria-hidden="true" tabindex="-1"></a>nmds.plot <span class="ot">&lt;-</span> site.scores <span class="sc">%&gt;%</span> </span>
<span id="cb45-197"><a href="#cb45-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(NMDS1, NMDS2, <span class="at">fill =</span> Fert_Level)) <span class="sc">+</span>  </span>
<span id="cb45-198"><a href="#cb45-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.0</span>,</span>
<span id="cb45-199"><a href="#cb45-199" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">"grey"</span>,</span>
<span id="cb45-200"><a href="#cb45-200" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-201"><a href="#cb45-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.0</span>,</span>
<span id="cb45-202"><a href="#cb45-202" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">"grey"</span>,</span>
<span id="cb45-203"><a href="#cb45-203" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-204"><a href="#cb45-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span> </span>
<span id="cb45-205"><a href="#cb45-205" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb45-206"><a href="#cb45-206" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb45-207"><a href="#cb45-207" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb45-208"><a href="#cb45-208" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb45-209"><a href="#cb45-209" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb45-210"><a href="#cb45-210" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb45-211"><a href="#cb45-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb45-212"><a href="#cb45-212" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb45-213"><a href="#cb45-213" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray95"</span>),</span>
<span id="cb45-214"><a href="#cb45-214" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span>
<span id="cb45-215"><a href="#cb45-215" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb45-216"><a href="#cb45-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"Fertilizer Level&lt;br&gt;</span></span>
<span id="cb45-217"><a href="#cb45-217" aria-hidden="true" tabindex="-1"></a><span class="st">                              &lt;span style = 'font-size:8pt;'&gt;</span></span>
<span id="cb45-218"><a href="#cb45-218" aria-hidden="true" tabindex="-1"></a><span class="st">                              (kg N ha&lt;sup&gt;-1&lt;/sup&gt; y&lt;sup&gt;-1&lt;/sup&gt;)</span></span>
<span id="cb45-219"><a href="#cb45-219" aria-hidden="true" tabindex="-1"></a><span class="st">                              &lt;/span&gt;"</span>) <span class="sc">+</span></span>
<span id="cb45-220"><a href="#cb45-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb45-221"><a href="#cb45-221" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">5</span>))</span>
<span id="cb45-222"><a href="#cb45-222" aria-hidden="true" tabindex="-1"></a>  )  </span>
<span id="cb45-223"><a href="#cb45-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-224"><a href="#cb45-224" aria-hidden="true" tabindex="-1"></a>nmds.plot</span>
<span id="cb45-225"><a href="#cb45-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-226"><a href="#cb45-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-227"><a href="#cb45-227" aria-hidden="true" tabindex="-1"></a>We can also add ellipses to the plot indicate confidence intervals  if you're interested in that:</span>
<span id="cb45-228"><a href="#cb45-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-231"><a href="#cb45-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-232"><a href="#cb45-232" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-233"><a href="#cb45-233" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Adding ellipses"</span></span>
<span id="cb45-234"><a href="#cb45-234" aria-hidden="true" tabindex="-1"></a>nmds.plot <span class="sc">+</span></span>
<span id="cb45-235"><a href="#cb45-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(<span class="at">color =</span> Fert_Level), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) </span>
<span id="cb45-236"><a href="#cb45-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-237"><a href="#cb45-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-238"><a href="#cb45-238" aria-hidden="true" tabindex="-1"></a>And again with shading:</span>
<span id="cb45-239"><a href="#cb45-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-242"><a href="#cb45-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-243"><a href="#cb45-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-244"><a href="#cb45-244" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Adding shading"</span></span>
<span id="cb45-245"><a href="#cb45-245" aria-hidden="true" tabindex="-1"></a>nmds.plot <span class="sc">+</span></span>
<span id="cb45-246"><a href="#cb45-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(<span class="at">color =</span> Fert_Level), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb45-247"><a href="#cb45-247" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Fert_Level), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) </span>
<span id="cb45-248"><a href="#cb45-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-249"><a href="#cb45-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-250"><a href="#cb45-250" aria-hidden="true" tabindex="-1"></a><span class="fu">## Arrows!</span></span>
<span id="cb45-251"><a href="#cb45-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-252"><a href="#cb45-252" aria-hidden="true" tabindex="-1"></a>Let's calculate the loading factors of the individual amoas:</span>
<span id="cb45-253"><a href="#cb45-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-256"><a href="#cb45-256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-257"><a href="#cb45-257" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-258"><a href="#cb45-258" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Calculating loadings"</span></span>
<span id="cb45-259"><a href="#cb45-259" aria-hidden="true" tabindex="-1"></a>dune_dist <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(data.priming <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">'amoA'</span>)))</span>
<span id="cb45-260"><a href="#cb45-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-261"><a href="#cb45-261" aria-hidden="true" tabindex="-1"></a>amoa_anosim <span class="ot">&lt;-</span> <span class="fu">anosim</span>(dune_dist, data.priming<span class="sc">$</span>fert_level)</span>
<span id="cb45-262"><a href="#cb45-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-263"><a href="#cb45-263" aria-hidden="true" tabindex="-1"></a>mds.spp.fit <span class="ot">&lt;-</span> <span class="fu">envfit</span>(mds.priming, data.priming.reduced <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"amoa"</span>)), <span class="at">permutations =</span> <span class="dv">999</span>)</span>
<span id="cb45-264"><a href="#cb45-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-265"><a href="#cb45-265" aria-hidden="true" tabindex="-1"></a>spp.scrs <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scores</span>(mds.spp.fit, <span class="at">display =</span> <span class="st">"vectors"</span>)) </span>
<span id="cb45-266"><a href="#cb45-266" aria-hidden="true" tabindex="-1"></a>spp.scrs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spp.scrs, <span class="at">Species =</span> <span class="fu">rownames</span>(spp.scrs)) </span>
<span id="cb45-267"><a href="#cb45-267" aria-hidden="true" tabindex="-1"></a>spp.scrs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spp.scrs, <span class="at">pval =</span> mds.spp.fit<span class="sc">$</span>vectors<span class="sc">$</span>pvals)</span>
<span id="cb45-268"><a href="#cb45-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-269"><a href="#cb45-269" aria-hidden="true" tabindex="-1"></a>spp.scores <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scores</span>(mds.spp.fit, <span class="at">display =</span> <span class="st">"vectors"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-270"><a href="#cb45-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">rownames</span>(.),</span>
<span id="cb45-271"><a href="#cb45-271" aria-hidden="true" tabindex="-1"></a>         <span class="at">pval =</span> mds.spp.fit<span class="sc">$</span>vectors<span class="sc">$</span>pvals)</span>
<span id="cb45-272"><a href="#cb45-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-273"><a href="#cb45-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-274"><a href="#cb45-274" aria-hidden="true" tabindex="-1"></a>This is enough to plot arrows on the NMDS. </span>
<span id="cb45-275"><a href="#cb45-275" aria-hidden="true" tabindex="-1"></a>We'll show the loadings of some amoAs of interest that we identified in a previous analysis.</span>
<span id="cb45-276"><a href="#cb45-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-279"><a href="#cb45-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-280"><a href="#cb45-280" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-281"><a href="#cb45-281" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Plotting arrows"</span></span>
<span id="cb45-282"><a href="#cb45-282" aria-hidden="true" tabindex="-1"></a>special <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"amoA.012"</span>, <span class="st">"amoA.031"</span>, <span class="st">"amoA.035"</span>, <span class="st">"amoA.042"</span>, <span class="st">"amoA.045"</span>, <span class="st">"amoA.070"</span>)</span>
<span id="cb45-283"><a href="#cb45-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-284"><a href="#cb45-284" aria-hidden="true" tabindex="-1"></a>special_arrows <span class="ot">&lt;-</span> spp.scores <span class="sc">%&gt;%</span> </span>
<span id="cb45-285"><a href="#cb45-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb45-286"><a href="#cb45-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rowname <span class="sc">%in%</span> special) <span class="sc">%&gt;%</span> </span>
<span id="cb45-287"><a href="#cb45-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.25</span> <span class="sc">*</span> NMDS1,</span>
<span id="cb45-288"><a href="#cb45-288" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.25</span> <span class="sc">*</span> NMDS2,</span>
<span id="cb45-289"><a href="#cb45-289" aria-hidden="true" tabindex="-1"></a>         <span class="at">assay =</span> <span class="fu">str_sub</span>(rowname, <span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb45-290"><a href="#cb45-290" aria-hidden="true" tabindex="-1"></a>         <span class="at">assay =</span> <span class="fu">paste0</span>(<span class="st">"amoA_AOB_p"</span>, assay)</span>
<span id="cb45-291"><a href="#cb45-291" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb45-292"><a href="#cb45-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-293"><a href="#cb45-293" aria-hidden="true" tabindex="-1"></a>nmds.plot <span class="sc">+</span></span>
<span id="cb45-294"><a href="#cb45-294" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="at">data =</span> special_arrows,</span>
<span id="cb45-295"><a href="#cb45-295" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="sc">-</span><span class="fl">0.3</span> <span class="sc">*</span> NMDS1,</span>
<span id="cb45-296"><a href="#cb45-296" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="sc">-</span><span class="fl">0.3</span> <span class="sc">*</span> NMDS2),</span>
<span id="cb45-297"><a href="#cb45-297" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.66</span>,</span>
<span id="cb45-298"><a href="#cb45-298" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">"cm"</span>)),</span>
<span id="cb45-299"><a href="#cb45-299" aria-hidden="true" tabindex="-1"></a>                             <span class="at">color =</span> <span class="st">"grey10"</span>, <span class="at">lwd =</span> <span class="fl">0.3</span>,</span>
<span id="cb45-300"><a href="#cb45-300" aria-hidden="true" tabindex="-1"></a>               <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb45-301"><a href="#cb45-301" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(</span>
<span id="cb45-302"><a href="#cb45-302" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> special_arrows,</span>
<span id="cb45-303"><a href="#cb45-303" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(x <span class="sc">*</span> <span class="dv">1</span>, y <span class="sc">*</span> <span class="dv">1</span>, <span class="at">label =</span> assay),</span>
<span id="cb45-304"><a href="#cb45-304" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb45-305"><a href="#cb45-305" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb45-306"><a href="#cb45-306" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb45-307"><a href="#cb45-307" aria-hidden="true" tabindex="-1"></a>    <span class="at">force =</span> <span class="dv">1</span>,</span>
<span id="cb45-308"><a href="#cb45-308" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="sc">-</span><span class="fl">0.001</span></span>
<span id="cb45-309"><a href="#cb45-309" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb45-310"><a href="#cb45-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb45-311"><a href="#cb45-311" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb45-312"><a href="#cb45-312" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"ANOSIM R = "</span>, <span class="fu">round</span>(amoa_anosim<span class="sc">$</span>statistic, <span class="dv">2</span>),</span>
<span id="cb45-313"><a href="#cb45-313" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"</span><span class="sc">\n</span><span class="st">p &lt; 0.001"</span>),</span>
<span id="cb45-314"><a href="#cb45-314" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fl">0.4</span>,</span>
<span id="cb45-315"><a href="#cb45-315" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fl">0.25</span>,</span>
<span id="cb45-316"><a href="#cb45-316" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb45-317"><a href="#cb45-317" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="dv">2</span></span>
<span id="cb45-318"><a href="#cb45-318" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb45-319"><a href="#cb45-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(<span class="at">color =</span> Fert_Level), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>)</span>
<span id="cb45-320"><a href="#cb45-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-321"><a href="#cb45-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-322"><a href="#cb45-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-323"><a href="#cb45-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-324"><a href="#cb45-324" aria-hidden="true" tabindex="-1"></a><span class="fu">## Statistics</span></span>
<span id="cb45-325"><a href="#cb45-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-326"><a href="#cb45-326" aria-hidden="true" tabindex="-1"></a><span class="fu">### Which factors have an impact on overall community composition?</span></span>
<span id="cb45-327"><a href="#cb45-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-330"><a href="#cb45-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-331"><a href="#cb45-331" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> data.priming.reduced <span class="sc">%&gt;%</span> </span>
<span id="cb45-332"><a href="#cb45-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="fu">contains</span>(<span class="st">"amoa"</span>)))</span>
<span id="cb45-333"><a href="#cb45-333" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> data.priming.reduced <span class="sc">%&gt;%</span> </span>
<span id="cb45-334"><a href="#cb45-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="fu">contains</span>(<span class="st">"amoa"</span>)))</span>
<span id="cb45-335"><a href="#cb45-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-336"><a href="#cb45-336" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis</span>(Y <span class="sc">~</span> X<span class="sc">$</span>fert_level <span class="sc">+</span> X<span class="sc">$</span>addition <span class="sc">+</span> X<span class="sc">$</span>crop <span class="sc">+</span> X<span class="sc">$</span>timepoint) </span>
<span id="cb45-337"><a href="#cb45-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-338"><a href="#cb45-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-339"><a href="#cb45-339" aria-hidden="true" tabindex="-1"></a>This tells us that fertilization level is very significant and explains ~37% of the variation</span>
<span id="cb45-340"><a href="#cb45-340" aria-hidden="true" tabindex="-1"></a>in our samples. Crop is also a significant factor on community composition, though it only explains</span>
<span id="cb45-341"><a href="#cb45-341" aria-hidden="true" tabindex="-1"></a>2.3% of the variation.</span>
<span id="cb45-342"><a href="#cb45-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-343"><a href="#cb45-343" aria-hidden="true" tabindex="-1"></a><span class="fu">### How do the treatment factors affect the "abundance" of genes on an individual level?</span></span>
<span id="cb45-344"><a href="#cb45-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-345"><a href="#cb45-345" aria-hidden="true" tabindex="-1"></a>All the code below does is perform an ANOVA of the gene's abundance against all the terms</span>
<span id="cb45-346"><a href="#cb45-346" aria-hidden="true" tabindex="-1"></a>and all of their interactions.</span>
<span id="cb45-347"><a href="#cb45-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-350"><a href="#cb45-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-351"><a href="#cb45-351" aria-hidden="true" tabindex="-1"></a>formulae <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">colnames</span>(data.priming.reduced <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"amoA"</span>))), <span class="cf">function</span>(x) <span class="fu">as.formula</span>(<span class="fu">paste0</span>(x, <span class="st">" ~ fert_level * crop * timepoint * addition"</span>)))</span>
<span id="cb45-352"><a href="#cb45-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-353"><a href="#cb45-353" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(formulae, <span class="cf">function</span>(x) broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="fu">aov</span>(x, <span class="at">data =</span> data.priming.reduced)))</span>
<span id="cb45-354"><a href="#cb45-354" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(res) <span class="ot">&lt;-</span> <span class="fu">format</span>(formulae)</span>
<span id="cb45-355"><a href="#cb45-355" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(res) <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(<span class="fu">names</span>(res), <span class="at">end =</span> <span class="dv">8</span>)</span>
<span id="cb45-356"><a href="#cb45-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-357"><a href="#cb45-357" aria-hidden="true" tabindex="-1"></a>anova_results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(res), <span class="cf">function</span>(i) res[[i]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">gene =</span> <span class="fu">names</span>(res)[[i]])) <span class="sc">%&gt;%</span> </span>
<span id="cb45-358"><a href="#cb45-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb45-359"><a href="#cb45-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"Residuals"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-360"><a href="#cb45-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sig =</span> <span class="fu">case_when</span>(</span>
<span id="cb45-361"><a href="#cb45-361" aria-hidden="true" tabindex="-1"></a>    p.value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> p.value <span class="sc">&gt;</span> <span class="fl">0.01</span> <span class="sc">~</span> <span class="st">"*"</span>,</span>
<span id="cb45-362"><a href="#cb45-362" aria-hidden="true" tabindex="-1"></a>    p.value <span class="sc">&lt;</span> <span class="fl">0.01</span> <span class="sc">&amp;</span> p.value <span class="sc">&gt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"**"</span>,</span>
<span id="cb45-363"><a href="#cb45-363" aria-hidden="true" tabindex="-1"></a>    p.value <span class="sc">&lt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"***"</span>,</span>
<span id="cb45-364"><a href="#cb45-364" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NS"</span></span>
<span id="cb45-365"><a href="#cb45-365" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb45-366"><a href="#cb45-366" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-367"><a href="#cb45-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-368"><a href="#cb45-368" aria-hidden="true" tabindex="-1"></a>Visualization:</span>
<span id="cb45-369"><a href="#cb45-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-372"><a href="#cb45-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-373"><a href="#cb45-373" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-374"><a href="#cb45-374" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "ANOVA visualization"</span></span>
<span id="cb45-375"><a href="#cb45-375" aria-hidden="true" tabindex="-1"></a>anova_results <span class="sc">%&gt;%</span> </span>
<span id="cb45-376"><a href="#cb45-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gene =</span> <span class="fu">str_sub</span>(gene, <span class="sc">-</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-377"><a href="#cb45-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(gene, term, <span class="at">fill =</span> sig)) <span class="sc">+</span> </span>
<span id="cb45-378"><a href="#cb45-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb45-379"><a href="#cb45-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span> </span>
<span id="cb45-380"><a href="#cb45-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb45-381"><a href="#cb45-381" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"amoA"</span>,</span>
<span id="cb45-382"><a href="#cb45-382" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Summary of ANOVA results"</span>,</span>
<span id="cb45-383"><a href="#cb45-383" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Significance "</span>) <span class="sc">+</span> </span>
<span id="cb45-384"><a href="#cb45-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb45-385"><a href="#cb45-385" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb45-386"><a href="#cb45-386" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb45-387"><a href="#cb45-387" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb45-388"><a href="#cb45-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb45-389"><a href="#cb45-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-390"><a href="#cb45-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-391"><a href="#cb45-391" aria-hidden="true" tabindex="-1"></a>Overall, we see that, again, fertilization level has a significant impact on abundance levels of the individual genes, and it's not even really that close.</span>
<span id="cb45-392"><a href="#cb45-392" aria-hidden="true" tabindex="-1"></a>There are other factors that might be worth investigating on a gene-by-gene basis, too, but that's for later.</span>
<span id="cb45-393"><a href="#cb45-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-394"><a href="#cb45-394" aria-hidden="true" tabindex="-1"></a><span class="fu">## Biodiversity</span></span>
<span id="cb45-395"><a href="#cb45-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-396"><a href="#cb45-396" aria-hidden="true" tabindex="-1"></a>Let's start by visualizing the presence/absence table:</span>
<span id="cb45-397"><a href="#cb45-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-400"><a href="#cb45-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-401"><a href="#cb45-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-402"><a href="#cb45-402" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Presence/absence plot"</span></span>
<span id="cb45-403"><a href="#cb45-403" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb45-404"><a href="#cb45-404" aria-hidden="true" tabindex="-1"></a>amoA_presence_absence <span class="sc">%&gt;%</span> </span>
<span id="cb45-405"><a href="#cb45-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"amoA"</span>), <span class="at">names_to =</span> <span class="st">"amoA"</span>, <span class="at">values_to =</span> <span class="st">"presence"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-406"><a href="#cb45-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">amoA =</span> <span class="fu">str_sub</span>(amoA, <span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb45-407"><a href="#cb45-407" aria-hidden="true" tabindex="-1"></a>         <span class="at">amoA =</span> <span class="fu">paste0</span>(<span class="st">"amoA_AOB_p"</span>, amoA),</span>
<span id="cb45-408"><a href="#cb45-408" aria-hidden="true" tabindex="-1"></a>         <span class="at">presence =</span> <span class="fu">as.factor</span>(presence)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-409"><a href="#cb45-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(metadata <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-410"><a href="#cb45-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">strip_label =</span> <span class="fu">paste0</span>(fert_level, <span class="st">" kg N ha&lt;sup&gt;-1&lt;/sup&gt; y&lt;sup&gt;-1&lt;/sup&gt;"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-411"><a href="#cb45-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sample_id, amoA, <span class="at">fill =</span> presence)) <span class="sc">+</span> </span>
<span id="cb45-412"><a href="#cb45-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb45-413"><a href="#cb45-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-414"><a href="#cb45-414" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Sample name"</span>,</span>
<span id="cb45-415"><a href="#cb45-415" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Primer pair"</span>,</span>
<span id="cb45-416"><a href="#cb45-416" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Species is:"</span>,</span>
<span id="cb45-417"><a href="#cb45-417" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>,</span>
<span id="cb45-418"><a href="#cb45-418" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">""</span></span>
<span id="cb45-419"><a href="#cb45-419" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb45-420"><a href="#cb45-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Absent"</span>, <span class="st">"Present"</span>),</span>
<span id="cb45-421"><a href="#cb45-421" aria-hidden="true" tabindex="-1"></a>                       <span class="at">begin =</span> <span class="dv">0</span>, <span class="at">end =</span> <span class="dv">1</span>,</span>
<span id="cb45-422"><a href="#cb45-422" aria-hidden="true" tabindex="-1"></a>                       <span class="at">option =</span> <span class="st">"magma"</span>) <span class="sc">+</span></span>
<span id="cb45-423"><a href="#cb45-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb45-424"><a href="#cb45-424" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="fl">0.25</span>),</span>
<span id="cb45-425"><a href="#cb45-425" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb45-426"><a href="#cb45-426" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb45-427"><a href="#cb45-427" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb45-428"><a href="#cb45-428" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb45-429"><a href="#cb45-429" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"blaCk"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb45-430"><a href="#cb45-430" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">"cm"</span>)</span>
<span id="cb45-431"><a href="#cb45-431" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb45-432"><a href="#cb45-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb45-433"><a href="#cb45-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> strip_label, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb45-434"><a href="#cb45-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-435"><a href="#cb45-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-436"><a href="#cb45-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-437"><a href="#cb45-437" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reading in the best BLAST hit info:</span></span>
<span id="cb45-438"><a href="#cb45-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-441"><a href="#cb45-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-442"><a href="#cb45-442" aria-hidden="true" tabindex="-1"></a>amoA_organism_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"data/amoa_mfp_qpcr_org_accessions.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-443"><a href="#cb45-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"forward"</span>, <span class="st">"reverse"</span>, <span class="st">"notes"</span>)))) </span>
<span id="cb45-444"><a href="#cb45-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-445"><a href="#cb45-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-446"><a href="#cb45-446" aria-hidden="true" tabindex="-1"></a>Counts of best BLAST hits:</span>
<span id="cb45-447"><a href="#cb45-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-450"><a href="#cb45-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-451"><a href="#cb45-451" aria-hidden="true" tabindex="-1"></a>amoA_organism_info <span class="sc">%&gt;%</span> </span>
<span id="cb45-452"><a href="#cb45-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(best_blast_hits, <span class="at">sort =</span> <span class="cn">TRUE</span>) </span>
<span id="cb45-453"><a href="#cb45-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-454"><a href="#cb45-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-455"><a href="#cb45-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-456"><a href="#cb45-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-457"><a href="#cb45-457" aria-hidden="true" tabindex="-1"></a><span class="fu">## Creating a phyloseq object</span></span>
<span id="cb45-458"><a href="#cb45-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-459"><a href="#cb45-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-460"><a href="#cb45-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r other-error-chunk, message=FALSE, warning=FALSE}</span></span>
<span id="cb45-461"><a href="#cb45-461" aria-hidden="true" tabindex="-1"></a><span class="in">amoa_tax_table &lt;- amoA_organism_info %&gt;% </span></span>
<span id="cb45-462"><a href="#cb45-462" aria-hidden="true" tabindex="-1"></a><span class="in">  select(array_name, best_blast_hits) %&gt;% </span></span>
<span id="cb45-463"><a href="#cb45-463" aria-hidden="true" tabindex="-1"></a><span class="in">  column_to_rownames(var = "array_name") %&gt;% </span></span>
<span id="cb45-464"><a href="#cb45-464" aria-hidden="true" tabindex="-1"></a><span class="in">  tax_table()</span></span>
<span id="cb45-465"><a href="#cb45-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-466"><a href="#cb45-466" aria-hidden="true" tabindex="-1"></a><span class="in">rownames(amoa_tax_table) &lt;- amoA_organism_info$array_name</span></span>
<span id="cb45-467"><a href="#cb45-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-468"><a href="#cb45-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-469"><a href="#cb45-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-470"><a href="#cb45-470" aria-hidden="true" tabindex="-1"></a><span class="in">```{r error-chunk}</span></span>
<span id="cb45-471"><a href="#cb45-471" aria-hidden="true" tabindex="-1"></a><span class="in">ps &lt;- phyloseq(</span></span>
<span id="cb45-472"><a href="#cb45-472" aria-hidden="true" tabindex="-1"></a><span class="in">  otu_table(amoA_presence_absence %&gt;% column_to_rownames(var = "sample_id"), taxa_are_rows = FALSE),</span></span>
<span id="cb45-473"><a href="#cb45-473" aria-hidden="true" tabindex="-1"></a><span class="in">  sample_data(metadata),</span></span>
<span id="cb45-474"><a href="#cb45-474" aria-hidden="true" tabindex="-1"></a><span class="in">  amoa_tax_table</span></span>
<span id="cb45-475"><a href="#cb45-475" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb45-476"><a href="#cb45-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-477"><a href="#cb45-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-478"><a href="#cb45-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-479"><a href="#cb45-479" aria-hidden="true" tabindex="-1"></a><span class="fu">## Richness analysis</span></span>
<span id="cb45-480"><a href="#cb45-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-481"><a href="#cb45-481" aria-hidden="true" tabindex="-1"></a>How does observed richness and evenness change with treatment level? This is a modified diversity function</span>
<span id="cb45-482"><a href="#cb45-482" aria-hidden="true" tabindex="-1"></a>that does a bunch of nice stuff that <span class="in">`phyloseq::estimate_richness`</span> doesn't do.</span>
<span id="cb45-483"><a href="#cb45-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-486"><a href="#cb45-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-487"><a href="#cb45-487" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-488"><a href="#cb45-488" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Estimate richness function"</span></span>
<span id="cb45-489"><a href="#cb45-489" aria-hidden="true" tabindex="-1"></a>estimate_richness_mod <span class="ot">&lt;-</span> <span class="cf">function</span>(physeq, <span class="at">split=</span><span class="cn">TRUE</span>, <span class="at">measures=</span><span class="cn">NULL</span>){</span>
<span id="cb45-490"><a href="#cb45-490" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-491"><a href="#cb45-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-492"><a href="#cb45-492" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="sc">!</span>split ){</span>
<span id="cb45-493"><a href="#cb45-493" aria-hidden="true" tabindex="-1"></a>    OTU <span class="ot">&lt;-</span> <span class="fu">taxa_sums</span>(physeq)        </span>
<span id="cb45-494"><a href="#cb45-494" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>( split ){</span>
<span id="cb45-495"><a href="#cb45-495" aria-hidden="true" tabindex="-1"></a>    OTU <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">otu_table</span>(physeq), <span class="st">"matrix"</span>)</span>
<span id="cb45-496"><a href="#cb45-496" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( <span class="fu">taxa_are_rows</span>(physeq) ){ OTU <span class="ot">&lt;-</span> <span class="fu">t</span>(OTU) }</span>
<span id="cb45-497"><a href="#cb45-497" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-498"><a href="#cb45-498" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-499"><a href="#cb45-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-500"><a href="#cb45-500" aria-hidden="true" tabindex="-1"></a>  renamevec <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Chao1"</span>, <span class="st">"ACE"</span>, <span class="st">"Shannon"</span>, <span class="st">"Pielou"</span>, <span class="st">"Simpson"</span>, <span class="st">"InvSimpson"</span>, <span class="st">"SimpsonE"</span>, <span class="st">"Fisher"</span>)</span>
<span id="cb45-501"><a href="#cb45-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(renamevec) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"S.obs"</span>, <span class="st">"S.chao1"</span>, <span class="st">"S.ACE"</span>, <span class="st">"shannon"</span>, <span class="st">"pielou"</span>, <span class="st">"simpson"</span>, <span class="st">"invsimpson"</span>, <span class="st">"simpsone"</span>, <span class="st">"fisher"</span>)</span>
<span id="cb45-502"><a href="#cb45-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-503"><a href="#cb45-503" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">is.null</span>(measures) ){</span>
<span id="cb45-504"><a href="#cb45-504" aria-hidden="true" tabindex="-1"></a>    measures <span class="ot">=</span> <span class="fu">as.character</span>(renamevec)</span>
<span id="cb45-505"><a href="#cb45-505" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-506"><a href="#cb45-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-507"><a href="#cb45-507" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">any</span>(measures <span class="sc">%in%</span> <span class="fu">names</span>(renamevec)) ){</span>
<span id="cb45-508"><a href="#cb45-508" aria-hidden="true" tabindex="-1"></a>    measures[measures <span class="sc">%in%</span> <span class="fu">names</span>(renamevec)] <span class="ot">&lt;-</span> renamevec[<span class="fu">names</span>(renamevec) <span class="sc">%in%</span> measures]</span>
<span id="cb45-509"><a href="#cb45-509" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-510"><a href="#cb45-510" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-511"><a href="#cb45-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-512"><a href="#cb45-512" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="sc">!</span><span class="fu">any</span>(measures <span class="sc">%in%</span> renamevec) ){</span>
<span id="cb45-513"><a href="#cb45-513" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"None of the `measures` you provided are supported. Try default `NULL` instead."</span>)</span>
<span id="cb45-514"><a href="#cb45-514" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-515"><a href="#cb45-515" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-516"><a href="#cb45-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-517"><a href="#cb45-517" aria-hidden="true" tabindex="-1"></a>  outlist <span class="ot">=</span> <span class="fu">vector</span>(<span class="st">"list"</span>)</span>
<span id="cb45-518"><a href="#cb45-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-519"><a href="#cb45-519" aria-hidden="true" tabindex="-1"></a>  estimRmeas <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Chao1"</span>, <span class="st">"Observed"</span>, <span class="st">"ACE"</span>)</span>
<span id="cb45-520"><a href="#cb45-520" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">any</span>(estimRmeas <span class="sc">%in%</span> measures) ){</span>
<span id="cb45-521"><a href="#cb45-521" aria-hidden="true" tabindex="-1"></a>    outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(<span class="fu">t</span>(<span class="fu">data.frame</span>(<span class="fu">estimateR</span>(OTU)))))</span>
<span id="cb45-522"><a href="#cb45-522" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-523"><a href="#cb45-523" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="st">"Shannon"</span> <span class="sc">%in%</span> measures ){</span>
<span id="cb45-524"><a href="#cb45-524" aria-hidden="true" tabindex="-1"></a>    outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(<span class="at">shannon =</span> <span class="fu">diversity</span>(OTU, <span class="at">index=</span><span class="st">"shannon"</span>)))</span>
<span id="cb45-525"><a href="#cb45-525" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-526"><a href="#cb45-526" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="st">"Pielou"</span> <span class="sc">%in%</span> measures){</span>
<span id="cb45-527"><a href="#cb45-527" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print("Starting Pielou")</span></span>
<span id="cb45-528"><a href="#cb45-528" aria-hidden="true" tabindex="-1"></a>    outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(<span class="at">pielou =</span> <span class="fu">diversity</span>(OTU, <span class="at">index =</span> <span class="st">"shannon"</span>)<span class="sc">/</span><span class="fu">log</span>(<span class="fu">estimateR</span>(OTU)[<span class="st">"S.obs"</span>,])))</span>
<span id="cb45-529"><a href="#cb45-529" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-530"><a href="#cb45-530" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="st">"Simpson"</span> <span class="sc">%in%</span> measures ){</span>
<span id="cb45-531"><a href="#cb45-531" aria-hidden="true" tabindex="-1"></a>    outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(<span class="at">simpson =</span> <span class="fu">diversity</span>(OTU, <span class="at">index=</span><span class="st">"simpson"</span>)))</span>
<span id="cb45-532"><a href="#cb45-532" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-533"><a href="#cb45-533" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="st">"InvSimpson"</span> <span class="sc">%in%</span> measures ){</span>
<span id="cb45-534"><a href="#cb45-534" aria-hidden="true" tabindex="-1"></a>    outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(<span class="at">invsimpson =</span> <span class="fu">diversity</span>(OTU, <span class="at">index=</span><span class="st">"invsimpson"</span>)))</span>
<span id="cb45-535"><a href="#cb45-535" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-536"><a href="#cb45-536" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="st">"SimpsonE"</span> <span class="sc">%in%</span> measures ){</span>
<span id="cb45-537"><a href="#cb45-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-538"><a href="#cb45-538" aria-hidden="true" tabindex="-1"></a>    outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(<span class="at">simpsone =</span> <span class="fu">diversity</span>(OTU, <span class="at">index=</span><span class="st">"invsimpson"</span>)<span class="sc">/</span><span class="fu">estimateR</span>(OTU)[<span class="st">"S.obs"</span>,]))</span>
<span id="cb45-539"><a href="#cb45-539" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-540"><a href="#cb45-540" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="st">"Fisher"</span> <span class="sc">%in%</span> measures ){</span>
<span id="cb45-541"><a href="#cb45-541" aria-hidden="true" tabindex="-1"></a>    fisher <span class="ot">=</span> <span class="fu">tryCatch</span>(<span class="fu">fisher.alpha</span>(OTU, <span class="at">se=</span><span class="cn">TRUE</span>),</span>
<span id="cb45-542"><a href="#cb45-542" aria-hidden="true" tabindex="-1"></a>                      <span class="at">warning=</span><span class="cf">function</span>(w){</span>
<span id="cb45-543"><a href="#cb45-543" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">warning</span>(<span class="st">"phyloseq::estimate_richness: Warning in fisher.alpha(). See `?fisher.fit` or ?`fisher.alpha`. Treat fisher results with caution"</span>)</span>
<span id="cb45-544"><a href="#cb45-544" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">suppressWarnings</span>(<span class="fu">fisher.alpha</span>(OTU, <span class="at">se=</span><span class="cn">TRUE</span>)[, <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"se"</span>)])</span>
<span id="cb45-545"><a href="#cb45-545" aria-hidden="true" tabindex="-1"></a>                      }</span>
<span id="cb45-546"><a href="#cb45-546" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-547"><a href="#cb45-547" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">dim</span>(fisher))){</span>
<span id="cb45-548"><a href="#cb45-548" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(fisher)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fisher"</span>, <span class="st">"se.fisher"</span>)</span>
<span id="cb45-549"><a href="#cb45-549" aria-hidden="true" tabindex="-1"></a>      outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="fu">list</span>(fisher))</span>
<span id="cb45-550"><a href="#cb45-550" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb45-551"><a href="#cb45-551" aria-hidden="true" tabindex="-1"></a>      outlist <span class="ot">&lt;-</span> <span class="fu">c</span>(outlist, <span class="at">Fisher=</span><span class="fu">list</span>(fisher))</span>
<span id="cb45-552"><a href="#cb45-552" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-553"><a href="#cb45-553" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-554"><a href="#cb45-554" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">=</span> <span class="fu">do.call</span>(<span class="st">"cbind"</span>, outlist)</span>
<span id="cb45-555"><a href="#cb45-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-556"><a href="#cb45-556" aria-hidden="true" tabindex="-1"></a>  namechange <span class="ot">=</span> <span class="fu">intersect</span>(<span class="fu">colnames</span>(out), <span class="fu">names</span>(renamevec))</span>
<span id="cb45-557"><a href="#cb45-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(out)[<span class="fu">colnames</span>(out) <span class="sc">%in%</span> namechange] <span class="ot">&lt;-</span> renamevec[namechange]</span>
<span id="cb45-558"><a href="#cb45-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-559"><a href="#cb45-559" aria-hidden="true" tabindex="-1"></a>  colkeep <span class="ot">=</span> <span class="fu">sapply</span>(<span class="fu">paste0</span>(<span class="st">"(se</span><span class="sc">\\</span><span class="st">.){0,}"</span>, measures), grep, <span class="fu">colnames</span>(out), <span class="at">ignore.case=</span><span class="cn">TRUE</span>)</span>
<span id="cb45-560"><a href="#cb45-560" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">=</span> out[, <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">unlist</span>(colkeep))), drop<span class="ot">=</span><span class="cn">FALSE</span>]</span>
<span id="cb45-561"><a href="#cb45-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-562"><a href="#cb45-562" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(out)</span>
<span id="cb45-563"><a href="#cb45-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb45-564"><a href="#cb45-564" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-565"><a href="#cb45-565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-566"><a href="#cb45-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-567"><a href="#cb45-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-570"><a href="#cb45-570" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-571"><a href="#cb45-571" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-572"><a href="#cb45-572" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Calculate richnesses for sample groups"</span></span>
<span id="cb45-573"><a href="#cb45-573" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Shannon"</span>)</span>
<span id="cb45-574"><a href="#cb45-574" aria-hidden="true" tabindex="-1"></a>richness <span class="ot">&lt;-</span> <span class="fu">estimate_richness_mod</span>(ps, <span class="at">measures =</span> metrics) <span class="sc">%&gt;%</span> </span>
<span id="cb45-575"><a href="#cb45-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-576"><a href="#cb45-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_id =</span> <span class="fu">str_sub</span>(sample_id, <span class="at">start =</span> <span class="dv">2</span>)) </span>
<span id="cb45-577"><a href="#cb45-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-578"><a href="#cb45-578" aria-hidden="true" tabindex="-1"></a>richness <span class="ot">&lt;-</span> <span class="fu">left_join</span>(<span class="fu">sample_data</span>(ps) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_id"</span>), richness) <span class="sc">%&gt;%</span> </span>
<span id="cb45-579"><a href="#cb45-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Observed<span class="sc">:</span>Shannon, <span class="at">names_to =</span> <span class="st">"Metric"</span>, <span class="at">values_to =</span> <span class="st">"Value"</span>)</span>
<span id="cb45-580"><a href="#cb45-580" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-581"><a href="#cb45-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-582"><a href="#cb45-582" aria-hidden="true" tabindex="-1"></a><span class="fu">## Statistical tests</span></span>
<span id="cb45-583"><a href="#cb45-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-584"><a href="#cb45-584" aria-hidden="true" tabindex="-1"></a><span class="fu">### Significance test of fertilization level on richness.</span></span>
<span id="cb45-585"><a href="#cb45-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-588"><a href="#cb45-588" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-589"><a href="#cb45-589" aria-hidden="true" tabindex="-1"></a>(sig_rich_fert <span class="ot">&lt;-</span> <span class="fu">kruskal.test</span>(Value <span class="sc">~</span> fert_level, <span class="at">data =</span> richness <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Metric <span class="sc">==</span> <span class="st">"Observed"</span>)))</span>
<span id="cb45-590"><a href="#cb45-590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-591"><a href="#cb45-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-592"><a href="#cb45-592" aria-hidden="true" tabindex="-1"></a>The <span class="in">`p-value &lt; 0.001`</span> gives us strong statistical evidence that richness is significantly different between </span>
<span id="cb45-593"><a href="#cb45-593" aria-hidden="true" tabindex="-1"></a>fertilization treatment groups.</span>
<span id="cb45-594"><a href="#cb45-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-595"><a href="#cb45-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-596"><a href="#cb45-596" aria-hidden="true" tabindex="-1"></a><span class="fu">### Significance test of fertilization level on richness</span></span>
<span id="cb45-597"><a href="#cb45-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-600"><a href="#cb45-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-601"><a href="#cb45-601" aria-hidden="true" tabindex="-1"></a>(sig_even_fert <span class="ot">&lt;-</span> <span class="fu">kruskal.test</span>(Value <span class="sc">~</span> fert_level, <span class="at">data =</span> richness <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Metric <span class="sc">==</span> <span class="st">"Shannon"</span>)))</span>
<span id="cb45-602"><a href="#cb45-602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-603"><a href="#cb45-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-604"><a href="#cb45-604" aria-hidden="true" tabindex="-1"></a>The <span class="in">`p-value &lt; 0.001`</span> gives us strong statistical evidence that Shannon diversity is significantly different between </span>
<span id="cb45-605"><a href="#cb45-605" aria-hidden="true" tabindex="-1"></a>fertilization treatment groups.</span>
<span id="cb45-606"><a href="#cb45-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-607"><a href="#cb45-607" aria-hidden="true" tabindex="-1"></a><span class="fu">## Making nice plots for stat differences</span></span>
<span id="cb45-608"><a href="#cb45-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-609"><a href="#cb45-609" aria-hidden="true" tabindex="-1"></a>Standard deviations, mean</span>
<span id="cb45-610"><a href="#cb45-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-613"><a href="#cb45-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-614"><a href="#cb45-614" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-615"><a href="#cb45-615" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Generate alpha diversity plots"</span></span>
<span id="cb45-616"><a href="#cb45-616" aria-hidden="true" tabindex="-1"></a>summaries <span class="ot">&lt;-</span> richness <span class="sc">%&gt;%</span> </span>
<span id="cb45-617"><a href="#cb45-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Metric, fert_level) <span class="sc">%&gt;%</span> </span>
<span id="cb45-618"><a href="#cb45-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_val =</span> <span class="fu">mean</span>(Value), </span>
<span id="cb45-619"><a href="#cb45-619" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_val =</span> <span class="fu">sd</span>(Value),</span>
<span id="cb45-620"><a href="#cb45-620" aria-hidden="true" tabindex="-1"></a>            <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb45-621"><a href="#cb45-621" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-622"><a href="#cb45-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se =</span> <span class="fu">abs</span>((sd_val <span class="sc">/</span> <span class="fu">sqrt</span>(n)) <span class="sc">*</span> <span class="fu">qt</span>(<span class="fl">0.025</span>, n <span class="sc">-</span> <span class="dv">1</span>) )) <span class="sc">%&gt;%</span> </span>
<span id="cb45-623"><a href="#cb45-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ymax =</span> mean_val <span class="sc">+</span> se, </span>
<span id="cb45-624"><a href="#cb45-624" aria-hidden="true" tabindex="-1"></a>         <span class="at">ymin =</span> mean_val <span class="sc">-</span> se) </span>
<span id="cb45-625"><a href="#cb45-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-626"><a href="#cb45-626" aria-hidden="true" tabindex="-1"></a>this_annotation <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb45-627"><a href="#cb45-627" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Shannon"</span>),</span>
<span id="cb45-628"><a href="#cb45-628" aria-hidden="true" tabindex="-1"></a>  <span class="at">lab =</span> <span class="fu">c</span>(<span class="st">"***"</span>, <span class="st">"***"</span>),</span>
<span id="cb45-629"><a href="#cb45-629" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fl">1.5</span>,</span>
<span id="cb45-630"><a href="#cb45-630" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">50</span> <span class="sc">+</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">2</span>, <span class="dv">4</span> <span class="sc">+</span> <span class="fl">0.5</span>),</span>
<span id="cb45-631"><a href="#cb45-631" aria-hidden="true" tabindex="-1"></a>  <span class="at">lineheights =</span> <span class="fu">c</span>(<span class="dv">50</span> <span class="sc">+</span> <span class="dv">5</span>, <span class="dv">4</span> <span class="sc">+</span> <span class="fl">0.25</span>)</span>
<span id="cb45-632"><a href="#cb45-632" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-633"><a href="#cb45-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-634"><a href="#cb45-634" aria-hidden="true" tabindex="-1"></a>summaries <span class="sc">%&gt;%</span>  </span>
<span id="cb45-635"><a href="#cb45-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(fert_level, mean_val, <span class="at">fill =</span> fert_level)) <span class="sc">+</span> </span>
<span id="cb45-636"><a href="#cb45-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb45-637"><a href="#cb45-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Metric, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> </span>
<span id="cb45-638"><a href="#cb45-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb45-639"><a href="#cb45-639" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb45-640"><a href="#cb45-640" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-641"><a href="#cb45-641" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-642"><a href="#cb45-642" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb45-643"><a href="#cb45-643" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb45-644"><a href="#cb45-644" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb45-645"><a href="#cb45-645" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb45-646"><a href="#cb45-646" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-647"><a href="#cb45-647" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-648"><a href="#cb45-648" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-649"><a href="#cb45-649" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>),</span>
<span id="cb45-650"><a href="#cb45-650" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-651"><a href="#cb45-651" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"NA"</span>)</span>
<span id="cb45-652"><a href="#cb45-652" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb45-653"><a href="#cb45-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>))) <span class="sc">+</span> </span>
<span id="cb45-654"><a href="#cb45-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb45-655"><a href="#cb45-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb45-656"><a href="#cb45-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> this_annotation,</span>
<span id="cb45-657"><a href="#cb45-657" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> lab),</span>
<span id="cb45-658"><a href="#cb45-658" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb45-659"><a href="#cb45-659" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb45-660"><a href="#cb45-660" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb45-661"><a href="#cb45-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> this_annotation,</span>
<span id="cb45-662"><a href="#cb45-662" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>,</span>
<span id="cb45-663"><a href="#cb45-663" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> <span class="dv">2</span>, </span>
<span id="cb45-664"><a href="#cb45-664" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> lineheights,</span>
<span id="cb45-665"><a href="#cb45-665" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yend =</span> lineheights),</span>
<span id="cb45-666"><a href="#cb45-666" aria-hidden="true" tabindex="-1"></a>               <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb45-667"><a href="#cb45-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-668"><a href="#cb45-668" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fertilization Level</span><span class="sc">\n</span><span class="st">(*** = p &lt; 0.001 by Kruskal Wallis)"</span>,</span>
<span id="cb45-669"><a href="#cb45-669" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Alpha diversity metrics by fertilization level"</span></span>
<span id="cb45-670"><a href="#cb45-670" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-671"><a href="#cb45-671" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-672"><a href="#cb45-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-673"><a href="#cb45-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-674"><a href="#cb45-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-675"><a href="#cb45-675" aria-hidden="true" tabindex="-1"></a><span class="fu">## Beta diversity</span></span>
<span id="cb45-676"><a href="#cb45-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-677"><a href="#cb45-677" aria-hidden="true" tabindex="-1"></a>We'll start beta diversity analysis off by doing an ADONIS/PERMANOVA to determine if </span>
<span id="cb45-678"><a href="#cb45-678" aria-hidden="true" tabindex="-1"></a>treatment centroids/treatment variations are different between groups. </span>
<span id="cb45-679"><a href="#cb45-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-682"><a href="#cb45-682" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-683"><a href="#cb45-683" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb45-684"><a href="#cb45-684" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb45-685"><a href="#cb45-685" aria-hidden="true" tabindex="-1"></a>dis <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(<span class="fu">otu_table</span>(ps))</span>
<span id="cb45-686"><a href="#cb45-686" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">sample_data</span>(ps)<span class="sc">$</span>fert_level</span>
<span id="cb45-687"><a href="#cb45-687" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(dis, groups)</span>
<span id="cb45-688"><a href="#cb45-688" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod)</span>
<span id="cb45-689"><a href="#cb45-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-690"><a href="#cb45-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-691"><a href="#cb45-691" aria-hidden="true" tabindex="-1"></a>Since <span class="in">`p &lt;&lt;&lt;&lt; 0.0001`</span>, there is strong evidence that the overall community compositions</span>
<span id="cb45-692"><a href="#cb45-692" aria-hidden="true" tabindex="-1"></a>are significantly different (treatment centroid, distance to centroid, community variation)</span>
<span id="cb45-693"><a href="#cb45-693" aria-hidden="true" tabindex="-1"></a>between the two groups. W can visualize this with a 1 SD ellipse:</span>
<span id="cb45-694"><a href="#cb45-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-697"><a href="#cb45-697" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-698"><a href="#cb45-698" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">ellipse =</span> <span class="cn">TRUE</span>, <span class="at">hull =</span> <span class="cn">FALSE</span>) </span>
<span id="cb45-699"><a href="#cb45-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-700"><a href="#cb45-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-701"><a href="#cb45-701" aria-hidden="true" tabindex="-1"></a>We see that there is clear separation between the two treatment centroids. Let's do some more analysis on the </span>
<span id="cb45-702"><a href="#cb45-702" aria-hidden="true" tabindex="-1"></a>distance-to-centroids that we're seeing:</span>
<span id="cb45-703"><a href="#cb45-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-706"><a href="#cb45-706" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-707"><a href="#cb45-707" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-708"><a href="#cb45-708" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Distance-to-centroid plots"</span></span>
<span id="cb45-709"><a href="#cb45-709" aria-hidden="true" tabindex="-1"></a>betadistances <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb45-710"><a href="#cb45-710" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_frame =</span> mod<span class="sc">$</span>group,</span>
<span id="cb45-711"><a href="#cb45-711" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> mod<span class="sc">$</span>distances</span>
<span id="cb45-712"><a href="#cb45-712" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-713"><a href="#cb45-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-714"><a href="#cb45-714" aria-hidden="true" tabindex="-1"></a>betadistances <span class="sc">%&gt;%</span> </span>
<span id="cb45-715"><a href="#cb45-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(time_frame, distance)) <span class="sc">+</span> </span>
<span id="cb45-716"><a href="#cb45-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb45-717"><a href="#cb45-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">fill =</span> time_frame), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb45-718"><a href="#cb45-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb45-719"><a href="#cb45-719" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb45-720"><a href="#cb45-720" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-721"><a href="#cb45-721" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-722"><a href="#cb45-722" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-723"><a href="#cb45-723" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-724"><a href="#cb45-724" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb45-725"><a href="#cb45-725" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb45-726"><a href="#cb45-726" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">"cm"</span>),</span>
<span id="cb45-727"><a href="#cb45-727" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-728"><a href="#cb45-728" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb45-729"><a href="#cb45-729" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb45-730"><a href="#cb45-730" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-731"><a href="#cb45-731" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb45-732"><a href="#cb45-732" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-733"><a href="#cb45-733" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb45-734"><a href="#cb45-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-735"><a href="#cb45-735" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">""</span>,</span>
<span id="cb45-736"><a href="#cb45-736" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Distance to centroid"</span></span>
<span id="cb45-737"><a href="#cb45-737" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb45-738"><a href="#cb45-738" aria-hidden="true" tabindex="-1"></a>  ggsignif<span class="sc">::</span><span class="fu">geom_signif</span>(</span>
<span id="cb45-739"><a href="#cb45-739" aria-hidden="true" tabindex="-1"></a>    <span class="at">map_signif_level =</span> <span class="cn">TRUE</span>,</span>
<span id="cb45-740"><a href="#cb45-740" aria-hidden="true" tabindex="-1"></a>    <span class="at">comparisons =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"336"</span>)),</span>
<span id="cb45-741"><a href="#cb45-741" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> <span class="st">"t.test"</span>,</span>
<span id="cb45-742"><a href="#cb45-742" aria-hidden="true" tabindex="-1"></a>    <span class="at">step_increase =</span> <span class="fl">0.1</span>,</span>
<span id="cb45-743"><a href="#cb45-743" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb45-744"><a href="#cb45-744" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb45-745"><a href="#cb45-745" aria-hidden="true" tabindex="-1"></a>    <span class="at">textsize =</span> <span class="dv">5</span>,</span>
<span id="cb45-746"><a href="#cb45-746" aria-hidden="true" tabindex="-1"></a>    <span class="at">tip_length =</span> <span class="dv">0</span></span>
<span id="cb45-747"><a href="#cb45-747" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-748"><a href="#cb45-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-749"><a href="#cb45-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-750"><a href="#cb45-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-751"><a href="#cb45-751" aria-hidden="true" tabindex="-1"></a>The significance bar is coming from the PERMANOVA test we did above. We see that there is actually</span>
<span id="cb45-752"><a href="#cb45-752" aria-hidden="true" tabindex="-1"></a>less beta diversity (as meaasured by distance-to-centroid) in the fertilized group than in the non-</span>
<span id="cb45-753"><a href="#cb45-753" aria-hidden="true" tabindex="-1"></a>fertilized group. We'll see another visualization backing this up in the next section:</span>
<span id="cb45-754"><a href="#cb45-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-755"><a href="#cb45-755" aria-hidden="true" tabindex="-1"></a><span class="fu">## Composition</span></span>
<span id="cb45-756"><a href="#cb45-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-757"><a href="#cb45-757" aria-hidden="true" tabindex="-1"></a>Let's visualize the composition of the communities, separated by fertilization. We'll start with</span>
<span id="cb45-758"><a href="#cb45-758" aria-hidden="true" tabindex="-1"></a>raw counts - how many times was that best BLAST hit seen in that sample?</span>
<span id="cb45-759"><a href="#cb45-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-762"><a href="#cb45-762" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-763"><a href="#cb45-763" aria-hidden="true" tabindex="-1"></a><span class="fu">comp_barplot</span>(ps, <span class="st">"ta1"</span>,</span>
<span id="cb45-764"><a href="#cb45-764" aria-hidden="true" tabindex="-1"></a>             <span class="at">facet_by =</span> <span class="st">"fert_level"</span>,</span>
<span id="cb45-765"><a href="#cb45-765" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample_order =</span>  <span class="st">"default"</span>,</span>
<span id="cb45-766"><a href="#cb45-766" aria-hidden="true" tabindex="-1"></a>             <span class="at">tax_transform_for_plot =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb45-767"><a href="#cb45-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb45-768"><a href="#cb45-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-769"><a href="#cb45-769" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Sample composition by fertilization level"</span>,</span>
<span id="cb45-770"><a href="#cb45-770" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"(raw counts)"</span></span>
<span id="cb45-771"><a href="#cb45-771" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb45-772"><a href="#cb45-772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb45-773"><a href="#cb45-773" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-774"><a href="#cb45-774" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="sc">-</span><span class="dv">7</span>)),</span>
<span id="cb45-775"><a href="#cb45-775" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb45-776"><a href="#cb45-776" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb45-777"><a href="#cb45-777" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb45-778"><a href="#cb45-778" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb45-779"><a href="#cb45-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb45-780"><a href="#cb45-780" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Best BLAST hit"</span>, <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-781"><a href="#cb45-781" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-782"><a href="#cb45-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-783"><a href="#cb45-783" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-784"><a href="#cb45-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-785"><a href="#cb45-785" aria-hidden="true" tabindex="-1"></a>We see that overall the fertilized group appears to have more richness in it.</span>
<span id="cb45-786"><a href="#cb45-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-787"><a href="#cb45-787" aria-hidden="true" tabindex="-1"></a>How about sample composition? IE, relative abundances?</span>
<span id="cb45-788"><a href="#cb45-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-791"><a href="#cb45-791" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-792"><a href="#cb45-792" aria-hidden="true" tabindex="-1"></a><span class="fu">comp_barplot</span>(ps, <span class="st">"ta1"</span>,</span>
<span id="cb45-793"><a href="#cb45-793" aria-hidden="true" tabindex="-1"></a>             <span class="at">facet_by =</span> <span class="st">"fert_level"</span>,</span>
<span id="cb45-794"><a href="#cb45-794" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample_order =</span>  <span class="st">"default"</span>) <span class="sc">+</span></span>
<span id="cb45-795"><a href="#cb45-795" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb45-796"><a href="#cb45-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-797"><a href="#cb45-797" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Sample composition by fertilization level"</span>,</span>
<span id="cb45-798"><a href="#cb45-798" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"(relative abundance)"</span></span>
<span id="cb45-799"><a href="#cb45-799" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb45-800"><a href="#cb45-800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb45-801"><a href="#cb45-801" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-802"><a href="#cb45-802" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="sc">-</span><span class="dv">7</span>)),</span>
<span id="cb45-803"><a href="#cb45-803" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb45-804"><a href="#cb45-804" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb45-805"><a href="#cb45-805" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb45-806"><a href="#cb45-806" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb45-807"><a href="#cb45-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb45-808"><a href="#cb45-808" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Best BLAST hit"</span>, <span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-809"><a href="#cb45-809" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-810"><a href="#cb45-810" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-811"><a href="#cb45-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-812"><a href="#cb45-812" aria-hidden="true" tabindex="-1"></a>Two big things pop out:</span>
<span id="cb45-813"><a href="#cb45-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-814"><a href="#cb45-814" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Species distribution is more even in the fertilized group. This makes sense given previous results</span>
<span id="cb45-815"><a href="#cb45-815" aria-hidden="true" tabindex="-1"></a>showing that Shannon entropy is higher and beta diversity is lower in the fertilized group. You can also </span>
<span id="cb45-816"><a href="#cb45-816" aria-hidden="true" tabindex="-1"></a>see that the communities just look more like each other in the fertilized group, which manifests in shorter</span>
<span id="cb45-817"><a href="#cb45-817" aria-hidden="true" tabindex="-1"></a>distance-to-centroids/lower community variation.</span>
<span id="cb45-818"><a href="#cb45-818" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>There's more green in the fertilized group, suggesting that Nitrosolobus multiformus and Nitrosospira sp. En13 abundances are significantly affected by fertilization addition.</span>
<span id="cb45-819"><a href="#cb45-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-820"><a href="#cb45-820" aria-hidden="true" tabindex="-1"></a><span class="fu">## Statistics on a best BLAST hit level</span></span>
<span id="cb45-821"><a href="#cb45-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-822"><a href="#cb45-822" aria-hidden="true" tabindex="-1"></a>The next chunk is just doing some data transformation stuff to count the number of times</span>
<span id="cb45-823"><a href="#cb45-823" aria-hidden="true" tabindex="-1"></a>each organism was seen in each sample in preparation for the statistical analysis.</span>
<span id="cb45-824"><a href="#cb45-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-827"><a href="#cb45-827" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-828"><a href="#cb45-828" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb45-829"><a href="#cb45-829" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb45-830"><a href="#cb45-830" aria-hidden="true" tabindex="-1"></a>pa_count <span class="ot">&lt;-</span> ps <span class="sc">%&gt;%</span> </span>
<span id="cb45-831"><a href="#cb45-831" aria-hidden="true" tabindex="-1"></a>  <span class="fu">otu_table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-832"><a href="#cb45-832" aria-hidden="true" tabindex="-1"></a>  data.frame <span class="sc">%&gt;%</span></span>
<span id="cb45-833"><a href="#cb45-833" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-834"><a href="#cb45-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"amoA"</span>)) </span>
<span id="cb45-835"><a href="#cb45-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-836"><a href="#cb45-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-837"><a href="#cb45-837" aria-hidden="true" tabindex="-1"></a>org_table <span class="ot">&lt;-</span> <span class="fu">tax_table</span>(ps) <span class="sc">%&gt;%</span> </span>
<span id="cb45-838"><a href="#cb45-838" aria-hidden="true" tabindex="-1"></a>  data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb45-839"><a href="#cb45-839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"name"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-840"><a href="#cb45-840" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">bbh =</span> ta1) <span class="sc">%&gt;%</span> </span>
<span id="cb45-841"><a href="#cb45-841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cleaned_names =</span> janitor<span class="sc">::</span><span class="fu">make_clean_names</span>(bbh))</span>
<span id="cb45-842"><a href="#cb45-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-843"><a href="#cb45-843" aria-hidden="true" tabindex="-1"></a>bbh_sample_counts <span class="ot">&lt;-</span> <span class="fu">left_join</span>(pa_count, org_table, <span class="at">by =</span> <span class="st">"name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-844"><a href="#cb45-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sample_id, bbh) <span class="sc">%&gt;%</span> </span>
<span id="cb45-845"><a href="#cb45-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-846"><a href="#cb45-846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"bbh"</span>, <span class="at">values_from =</span> value)</span>
<span id="cb45-847"><a href="#cb45-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-848"><a href="#cb45-848" aria-hidden="true" tabindex="-1"></a>bbh_level_counts <span class="ot">&lt;-</span> <span class="fu">left_join</span>(bbh_sample_counts,</span>
<span id="cb45-849"><a href="#cb45-849" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sample_data</span>(ps) <span class="sc">%&gt;%</span> </span>
<span id="cb45-850"><a href="#cb45-850" aria-hidden="true" tabindex="-1"></a>            data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb45-851"><a href="#cb45-851" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">'sample_id'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-852"><a href="#cb45-852" aria-hidden="true" tabindex="-1"></a>            <span class="fu">right_join</span>(bbh_sample_counts)</span>
<span id="cb45-853"><a href="#cb45-853" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-854"><a href="#cb45-854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb45-855"><a href="#cb45-855" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-856"><a href="#cb45-856" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-857"><a href="#cb45-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-858"><a href="#cb45-858" aria-hidden="true" tabindex="-1"></a>Here, we're preparing formulas to feed to a <span class="in">`lapply`</span> function to perform a Kruskal-Wallis test on </span>
<span id="cb45-859"><a href="#cb45-859" aria-hidden="true" tabindex="-1"></a>all of the organisms.</span>
<span id="cb45-860"><a href="#cb45-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-863"><a href="#cb45-863" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-864"><a href="#cb45-864" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb45-865"><a href="#cb45-865" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb45-866"><a href="#cb45-866" aria-hidden="true" tabindex="-1"></a>formulae <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">colnames</span>(bbh_sample_counts <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>sample_id) <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>()) , <span class="cf">function</span>(x) <span class="fu">as.formula</span>(<span class="fu">paste0</span>(x, <span class="st">" ~ fert_level * crop * timepoint * addition"</span>)))</span>
<span id="cb45-867"><a href="#cb45-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-868"><a href="#cb45-868" aria-hidden="true" tabindex="-1"></a>formulae[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb45-869"><a href="#cb45-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-870"><a href="#cb45-870" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(formulae, <span class="cf">function</span>(x) broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="fu">aov</span>(x, <span class="at">data =</span> bbh_level_counts <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>())))</span>
<span id="cb45-871"><a href="#cb45-871" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(res) <span class="ot">&lt;-</span> <span class="fu">format</span>(formulae)</span>
<span id="cb45-872"><a href="#cb45-872" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(res) <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(res), <span class="cf">function</span>(x) <span class="fu">str_split</span>(x, <span class="st">"~"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()</span>
<span id="cb45-873"><a href="#cb45-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-874"><a href="#cb45-874" aria-hidden="true" tabindex="-1"></a>anova_results.counts <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(res), <span class="cf">function</span>(i) res[[i]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">gene =</span> <span class="fu">names</span>(res)[[i]])) <span class="sc">%&gt;%</span> </span>
<span id="cb45-875"><a href="#cb45-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb45-876"><a href="#cb45-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"Residuals"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-877"><a href="#cb45-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gene =</span> <span class="fu">str_trim</span>(gene))</span>
<span id="cb45-878"><a href="#cb45-878" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-879"><a href="#cb45-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-880"><a href="#cb45-880" aria-hidden="true" tabindex="-1"></a>Visualizing the results again:</span>
<span id="cb45-881"><a href="#cb45-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-884"><a href="#cb45-884" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-885"><a href="#cb45-885" aria-hidden="true" tabindex="-1"></a>anova_results.counts <span class="sc">%&gt;%</span></span>
<span id="cb45-886"><a href="#cb45-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(org_table, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"gene"</span> <span class="ot">=</span><span class="st">"cleaned_names"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-887"><a href="#cb45-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sig =</span> <span class="fu">case_when</span>(</span>
<span id="cb45-888"><a href="#cb45-888" aria-hidden="true" tabindex="-1"></a>    p.value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> p.value <span class="sc">&gt;</span> <span class="fl">0.01</span> <span class="sc">~</span> <span class="st">"*"</span>,</span>
<span id="cb45-889"><a href="#cb45-889" aria-hidden="true" tabindex="-1"></a>    p.value <span class="sc">&lt;</span> <span class="fl">0.01</span> <span class="sc">&amp;</span> p.value <span class="sc">&gt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"**"</span>,</span>
<span id="cb45-890"><a href="#cb45-890" aria-hidden="true" tabindex="-1"></a>    p.value <span class="sc">&lt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"***"</span>,</span>
<span id="cb45-891"><a href="#cb45-891" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NS"</span></span>
<span id="cb45-892"><a href="#cb45-892" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb45-893"><a href="#cb45-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(term, bbh, <span class="at">fill =</span> sig)) <span class="sc">+</span> </span>
<span id="cb45-894"><a href="#cb45-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb45-895"><a href="#cb45-895" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb45-896"><a href="#cb45-896" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb45-897"><a href="#cb45-897" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Summary of ANOVA results"</span>,</span>
<span id="cb45-898"><a href="#cb45-898" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Significance "</span>) <span class="sc">+</span> </span>
<span id="cb45-899"><a href="#cb45-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb45-900"><a href="#cb45-900" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb45-901"><a href="#cb45-901" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb45-902"><a href="#cb45-902" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>()</span>
<span id="cb45-903"><a href="#cb45-903" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb45-904"><a href="#cb45-904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb45-905"><a href="#cb45-905" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> rev) <span class="sc">+</span></span>
<span id="cb45-906"><a href="#cb45-906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() </span>
<span id="cb45-907"><a href="#cb45-907" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-908"><a href="#cb45-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-909"><a href="#cb45-909" aria-hidden="true" tabindex="-1"></a>We see the same pattern at the organism level as when we did this at the gene level:</span>
<span id="cb45-910"><a href="#cb45-910" aria-hidden="true" tabindex="-1"></a>fertilization level is by far the most significant factor affecting Presence/Absence of </span>
<span id="cb45-911"><a href="#cb45-911" aria-hidden="true" tabindex="-1"></a>organisms.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
<!-- -->
</section>
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        if (/\bviewer_pane=1\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    window.tippy(el, {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    }); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      const id = new URL(ref.getAttribute('href')).hash.replace(/^#/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</main>
<div class="page-navigation page-navigation-docked">
  <div class="nav-page nav-page-previous">
      <a href="../docs/third.html">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Example Jupyter Notebook</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</div>
</div> <!-- /main column -->
</div> <!-- /row -->
</div> <!-- /container fluid -->


</body></html>